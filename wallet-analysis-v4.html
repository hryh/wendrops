<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="/favicon.ico" />
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="/manifest.webmanifest" />
  <title>Wallet Analysis â€” WENDROPS</title>
  <meta name="description" content="Real blockchain wallet analysis across multiple networks for airdrop eligibility">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(() => {});
      });
    }
    // Hardened ethers loader: multiple CDNs + timeout
    window.__ethersReady = (function() {
      let resolveFn, rejectFn;
      const p = new Promise((res, rej) => { resolveFn = res; rejectFn = rej; });
      function load(src) {
        return new Promise((resolve, reject) => {
          const s = document.createElement('script');
          s.src = src;
          s.async = true;
          s.crossOrigin = 'anonymous';
          s.onload = () => resolve(true);
          s.onerror = () => reject(new Error('Failed: ' + src));
          document.head.appendChild(s);
        });
      }
      (async () => {
        const cdns = [
          'https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js',
          'https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js',
          'https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js',
          'https://cdn.skypack.dev/ethers@5.7.2?min'
        ];
        const deadline = Date.now() + 15000; // 15s overall cap
        for (const url of cdns) {
          try {
            await load(url);
            if (window.ethers) { console.log('ethers loaded from', url); resolveFn(true); return; }
          } catch (e) { console.warn('ethers load failed', url); }
          if (Date.now() > deadline) break;
        }
        rejectFn(new Error('ethers failed to load'));
      })();
      return p;
    })();
  </script>
  <script>
    // Force refresh cache
    if (performance.navigation.type === 1) {
      console.log('Page refreshed - cache cleared');
    }
  </script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'crypto-gold': '#FFD700',
            'crypto-blue': '#00D4FF',
            'crypto-purple': '#8B5CF6',
            'dark-bg': '#0A0A0A',
            'dark-card': '#1A1A1A',
            'dark-border': '#2A2A2A'
          }
        }
      },
      darkMode: 'class'
    }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #0A0A0A 0%, #1A1A1A 50%, #0A0A0A 100%);
      min-height: 100vh;
    }
    .glassmorphism {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body class="dark bg-dark-bg text-white">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-black/40 backdrop-blur-xl border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="flex items-center gap-2">
          <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center shadow-glow">
            <span class="text-black font-extrabold">W</span>
          </div>
          <h1 class="text-lg sm:text-xl font-semibold tracking-tight">WENDROPS</h1>
          <span class="ml-2 text-xs text-white/50">Pro</span>
        </div>
      </div>
      <nav class="flex items-center gap-2 text-sm">
        <a href="index.html" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition">Home</a>
        <a href="wallet-analysis-v4.html" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition">Wallet Analysis</a>
        <a href="points-system-v4.html" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition">Points System</a>
        <a href="terms.html" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition">Terms</a>
        <button id="toggleTheme" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition ml-1 text-white/80">Toggle Theme</button>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <!-- Hero Section -->
    <div class="text-center mb-12">
      <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-crypto-gold via-crypto-blue to-crypto-purple bg-clip-text text-transparent">
        Wallet Analysis
      </h1>
      <p class="text-xl text-gray-300 mb-8">Real blockchain wallet analysis across multiple networks</p>
    </div>

    <!-- Wallet Input -->
    <div class="glassmorphism rounded-xl p-8 mb-12">
      <h2 class="text-2xl font-bold mb-6 text-center">Enter Wallet Address</h2>
      <div class="max-w-2xl mx-auto">
        <div class="flex space-x-4">
          <input 
            type="text" 
            id="walletAddress" 
            placeholder="0x..." 
            class="flex-1 px-4 py-3 bg-dark-border border border-gray-600 rounded-lg focus:outline-none focus:border-crypto-blue"
          >
          <button 
            id="analyzeBtn" 
            class="px-8 py-3 bg-gradient-to-r from-crypto-purple to-crypto-blue text-white rounded-lg font-bold hover:shadow-lg transition-all transform hover:scale-105"
          >
            Analyze
          </button>
        </div>
        <p class="text-gray-400 mt-4 text-center">Enter any Ethereum wallet address to analyze its airdrop eligibility</p>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="hidden text-center py-12">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-crypto-blue"></div>
      <p class="mt-4 text-gray-300">Analyzing wallet...</p>
    </div>

    <!-- Analysis Results -->
    <div id="analysisResults" class="hidden">
      <!-- Wallet Overview -->
      <div class="glassmorphism rounded-xl p-8 mb-8">
        <h2 class="text-2xl font-bold mb-6">Wallet Overview</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <div class="text-sm text-gray-400 mb-1">Address</div>
            <div id="walletAddressDisplay" class="font-mono text-lg break-all"></div>
          </div>
          <div>
            <div class="text-sm text-gray-400 mb-1">Eligibility Score</div>
            <div id="eligibilityScore" class="text-3xl font-bold text-crypto-gold"></div>
          </div>
        </div>
      </div>

      <!-- Balance Information -->
      <div class="glassmorphism rounded-xl p-8 mb-8">
        <h2 class="text-2xl font-bold mb-6">Balance Information</h2>
        <div id="balanceInfo" class="space-y-4">
          <!-- Balance details will be populated by JavaScript -->
        </div>
      </div>

      <!-- Transaction History -->
      <div class="glassmorphism rounded-xl p-8 mb-8">
        <h2 class="text-2xl font-bold mb-6">Recent Transactions</h2>
        <div id="transactionHistory" class="space-y-4">
          <!-- Transaction details will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-dark-card/80 backdrop-blur-md border-t border-dark-border mt-16">
    <div class="container mx-auto px-4 py-8">
      <div class="text-center text-gray-400">
        <p>&copy; 2025 WENDROPS. All rights reserved.</p>
        <p class="mt-2">Discover, track, and participate in the best crypto airdrops.</p>
      </div>
    </div>
  </footer>

  <script>
    // RPC endpoints for different chains
    const RPC_ENDPOINTS = {
      ethereum: 'https://eth.llamarpc.com',
      polygon: 'https://polygon.llamarpc.com',
      bsc: 'https://bsc.llamarpc.com',
      arbitrum: 'https://arbitrum.llamarpc.com',
      base: 'https://base.llamarpc.com'
    };

    const CHAIN_CONFIG = {
      ethereum: { name: 'Ethereum', symbol: 'ETH', decimals: 18 },
      polygon: { name: 'Polygon', symbol: 'MATIC', decimals: 18 },
      bsc: { name: 'BNB Smart Chain', symbol: 'BNB', decimals: 18 },
      arbitrum: { name: 'Arbitrum', symbol: 'ETH', decimals: 18 },
      base: { name: 'Base', symbol: 'ETH', decimals: 18 }
    };

    // Initialize the app
    document.addEventListener('DOMContentLoaded', async function() {
      initializeEventListeners();
      initializeTheme();
      // Ensure ethers is loaded before usage to avoid runtime errors
      try { await window.__ethersReady; } catch (_) {}
    });

    // Initialize event listeners
    function initializeEventListeners() {
      document.getElementById('analyzeBtn').addEventListener('click', analyzeWallet);
      document.getElementById('walletAddress').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          analyzeWallet();
        }
      });
    }

    // Initialize theme
    function initializeTheme() {
      const themeToggle = document.getElementById('themeToggle');
      const themeIcon = document.getElementById('themeIcon');
      
      // Load saved theme
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.documentElement.classList.toggle('dark', savedTheme === 'dark');
      
      themeToggle.addEventListener('click', () => {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      });
    }

    // Validate Ethereum address
    function isValidAddress(address) {
      return /^0x[a-fA-F0-9]{40}$/.test(address);
    }

    // Format address for display
    function formatAddress(address) {
      return `${address.slice(0, 6)}...${address.slice(-4)}`;
    }

    // Format number with commas
    function formatNumber(num) {
      return num.toLocaleString();
    }

    // Format currency
    function formatCurrency(amount, symbol = 'ETH') {
      return `${parseFloat(amount).toFixed(4)} ${symbol}`;
    }

    // Get provider for specific chain
    function getProvider(chain) {
      const rpcUrl = RPC_ENDPOINTS[chain];
      if (!rpcUrl) throw new Error(`Unsupported chain: ${chain}`);
      return new ethers.providers.JsonRpcProvider(rpcUrl);
    }

    // Resolve ENS name to address if needed
    async function resolveEnsIfNeeded(input) {
      const val = input.trim();
      if (/^0x[a-fA-F0-9]{40}$/.test(val)) return val;
      if (!val.endsWith('.eth')) return val;
      try {
        const provider = new ethers.providers.JsonRpcProvider('https://cloudflare-eth.com');
        const addr = await provider.resolveName(val);
        return addr || val;
      } catch { return val; }
    }

    // Analyze wallet
    async function analyzeWallet() {
      const raw = document.getElementById('walletAddress').value.trim();
      const address = await resolveEnsIfNeeded(raw);
      
      if (!isValidAddress(address)) {
        alert('Please enter a valid Ethereum address');
        return;
      }

      // Show loading state
      document.getElementById('loadingState').classList.remove('hidden');
      document.getElementById('analysisResults').classList.add('hidden');

      try {
        // Wait for ethers to load
        if (!window.ethers) {
          try { await window.__ethersReady; } catch (e) { throw new Error('Ethers library not loaded'); }
        }

        const results = await analyzeWalletData(address);
        displayResults(address, results);
        
        // Hide loading state
        document.getElementById('loadingState').classList.add('hidden');
        document.getElementById('analysisResults').classList.remove('hidden');
        
      } catch (error) {
        console.error('Analysis failed:', error);
        alert('Analysis failed: ' + error.message);
        document.getElementById('loadingState').classList.add('hidden');
      }
    }

    // Analyze wallet data across chains
    async function analyzeWalletData(address) {
      const results = {
        balances: {},
        transactionCounts: {},
        eligibilityScore: 0
      };

      // Helper with timeout/retry
      async function withTimeout(promise, ms = 8000) {
        return await Promise.race([
          promise,
          new Promise((_, rej) => setTimeout(() => rej(new Error('timeout')), ms))
        ]);
      }
      async function fetchChain(chain, config) {
        try {
          const provider = getProvider(chain);
          const [balance, txCount] = await withTimeout(Promise.all([
            provider.getBalance(address),
            provider.getTransactionCount(address)
          ]));
          results.balances[chain] = {
            balance: ethers.utils.formatEther(balance),
            symbol: config.symbol,
            name: config.name
          };
          results.transactionCounts[chain] = txCount;
        } catch (err) {
          results.balances[chain] = { balance: '0', symbol: config.symbol, name: config.name, error: true };
          results.transactionCounts[chain] = 0;
        }
      }
      await Promise.all(Object.entries(CHAIN_CONFIG).map(([k, v]) => fetchChain(k, v)));

      // Calculate eligibility score
      results.eligibilityScore = calculateEligibilityScore(results);

      return results;
    }

    // Calculate eligibility score
    function calculateEligibilityScore(results) {
      let score = 0;
      
      // Base score for having any activity
      const hasActivity = Object.values(results.transactionCounts).some(count => count > 0);
      if (hasActivity) score += 20;

      // Score for balances across chains
      Object.values(results.balances).forEach(balance => {
        const bal = parseFloat(balance.balance);
        if (bal > 0) score += 10;
        if (bal > 0.1) score += 10;
        if (bal > 1) score += 20;
        if (bal > 10) score += 30;
      });

      // Score for transaction activity
      Object.values(results.transactionCounts).forEach(count => {
        if (count > 0) score += 5;
        if (count > 10) score += 10;
        if (count > 50) score += 15;
        if (count > 100) score += 20;
      });

      return Math.min(score, 100); // Cap at 100
    }

    // Display analysis results
    function displayResults(address, results) {
      // Update wallet overview
      document.getElementById('walletAddressDisplay').textContent = address;
      document.getElementById('eligibilityScore').textContent = `${results.eligibilityScore}/100`;

      // Update balance information
      const balanceInfo = document.getElementById('balanceInfo');
      balanceInfo.innerHTML = '';
      
      Object.entries(results.balances).forEach(([chain, data]) => {
        const balanceElement = document.createElement('div');
        balanceElement.className = 'flex justify-between items-center p-4 rounded-lg bg-dark-border';
        balanceElement.innerHTML = `
          <div>
            <div class="font-medium">${data.name}</div>
            <div class="text-sm text-gray-400">${chain}</div>
          </div>
          <div class="text-right">
            <div class="font-bold text-crypto-gold">${data.error ? 'Error' : formatCurrency(data.balance, data.symbol)}</div>
            <div class="text-sm text-gray-400">${results.transactionCounts[chain]} txs</div>
          </div>
        `;
        balanceInfo.appendChild(balanceElement);
      });

      // Update transaction history (mock data for now)
      const transactionHistory = document.getElementById('transactionHistory');
      transactionHistory.innerHTML = '<div class="text-gray-400 text-center py-8">Transaction history analysis coming soon...</div>';
    }
  </script>
</script>
  <script defer src="/_vercel/insights/script.js"></script>
  <script defer src="/_vercel/speed-insights/script.js"></script>
</body>
</html>


