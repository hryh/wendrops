<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hot on X ‚Äî Airdrop Hub</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext x='50%25' y='50%25' dy='.35em' text-anchor='middle'%3Eü™Ç%3C/text%3E%3C/svg%3E" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class', theme: { extend: {
      colors: { bg: '#0b0f1a', card: '#0f1422', edge: '#1a2337', accent: '#22d3ee' },
      boxShadow: { glow: '0 0 0.6rem rgba(34,211,238,0.35), 0 0 1.2rem rgba(34,211,238,0.2)' }
    } } }
  </script>
  <style>
    :root { color-scheme: dark; } html, body { background: #0b0f1a; color: #fff; }
    .btn { padding: 0.45rem 0.75rem; border-radius: 0.5rem; border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.06); }
    .btn:hover { border-color: rgba(255,255,255,0.25); }
    .chip { font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 0.375rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.12); }
    .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.1), rgba(255,255,255,0.06)); background-size: 200% 100%; animation: shine 1.2s linear infinite; }
    @keyframes shine { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
  </style>
  <script>
    (function () { try {
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      document.documentElement.classList.toggle('dark', (saved || (prefersDark ? 'dark' : 'light')) === 'dark');
    } catch {} })();
  </script>
</head>
<body class="min-h-screen">
  <header class="sticky top-0 z-40 bg-black/40 backdrop-blur border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <a href="index.html" class="text-cyan-300 font-semibold">AD</a>
        <a href="index.html" class="text-lg sm:text-xl font-semibold">Airdrop Hub</a>
        <span class="ml-2 text-xs text-white/50">Hot on X</span>
      </div>
      <nav class="flex items-center gap-4 text-sm">
        <a href="index.html" class="text-white/60 hover:text-white">Home</a>
        <a href="hot.html" class="text-white hover:text-white underline">Hot on X</a>
        <a href="runs.html" class="text-white/60 hover:text-white">Runs</a>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <section class="mb-4">
      <div class="grid sm:grid-cols-3 gap-3">
        <div class="sm:col-span-2">
          <input id="search" class="w-full btn" placeholder="Search topics, hashtags, or accounts..." />
        </div>
        <div class="grid grid-cols-3 gap-2">
          <select id="category" class="btn">
            <option value="all">All</option>
            <option>Protocols</option><option>Chains</option><option>Farming</option><option>Rumors</option><option>Security</option>
          </select>
          <select id="sort" class="btn">
            <option value="hot">Hotness</option>
            <option value="alpha">Alpha (recent)</option>
            <option value="az">A‚ÄìZ</option>
          </select>
          <button id="reset" class="btn">Reset</button>
        </div>
      </div>
      <p class="text-white/60 text-xs mt-2">Links to X searches and profiles. No scraping; clicks power ‚ÄúTrending‚Äù badges on Home.</p>
    </section>

    <section id="topics" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[160px]"></section>

    <section class="flex items-center justify-between mt-6">
      <button id="prev" class="btn">Prev</button>
      <div id="pageInfo" class="text-white/60 text-sm">0 results</div>
      <button id="next" class="btn">Next</button>
    </section>
  </main>

  <script>
    const PAGE_SIZE = 9;
    const state = (function(){ try {
      const qs = new URLSearchParams(location.search);
      return { q: qs.get('q') || '', cat: qs.get('cat') || 'all', sort: qs.get('sort') || 'hot', page: Number(qs.get('page') || 1) };
    } catch { return { q:'', cat:'all', sort:'hot', page:1 }; } })();
    function sync() {
      const url = new URL(location.href);
      if (state.q) url.searchParams.set('q', state.q); else url.searchParams.delete('q');
      if (state.cat && state.cat !== 'all') url.searchParams.set('cat', state.cat); else url.searchParams.delete('cat');
      if (state.sort && state.sort !== 'hot') url.searchParams.set('sort', state.sort); else url.searchParams.delete('sort');
      if (state.page > 1) url.searchParams.set('page', String(state.page)); else url.searchParams.delete('page');
      history.replaceState({}, '', url.toString());
    }
    const elTopics = document.getElementById('topics');
    const elSearch = document.getElementById('search');
    const elCat = document.getElementById('category');
    const elSort = document.getElementById('sort');
    const elPrev = document.getElementById('prev');
    const elNext = document.getElementById('next');
    const elInfo = document.getElementById('pageInfo');

    elSearch.value = state.q; elCat.value = state.cat; elSort.value = state.sort;

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function searchUrl(topic) { const q = encodeURIComponent(topic.query || topic.hashtag || topic.keyword || topic.name); return `https://x.com/search?q=${q}&src=typed_query&f=live`; }
    function accountUrl(handle) { return `https://x.com/${handle.replace(/^@/, '')}`; }

    let TOPICS = []; let filtered = [];

    async function load() {
      try {
        elTopics.innerHTML = Array.from({length: 6}).map(()=>`
          <div class="rounded-lg border border-white/10 p-4">
            <div class="h-5 w-1/2 skeleton rounded mb-3"></div>
            <div class="h-10 skeleton rounded"></div>
          </div>
        `).join('');
        const res = await fetch('data/hot-topics.json', { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        TOPICS = await res.json();
        const clicks = JSON.parse(localStorage.getItem('x_clicks') || '{}');
        TOPICS.forEach(t => t._clicks = clicks[t.id] || 0);
        apply(); render();
      } catch (e) {
        elTopics.innerHTML = `<p class="text-white/70">Failed to load topics: ${escapeHtml(e.message)}</p>`;
        elInfo.textContent = '0 results';
      }
    }

    function apply() {
      const q = state.q.trim().toLowerCase();
      filtered = TOPICS.filter(t => {
        if (state.cat !== 'all' && t.category !== state.cat) return false;
        if (q) {
          const hay = `${t.name} ${t.keyword||''} ${t.hashtag||''} ${t.accounts?.join(' ')||''}`.toLowerCase();
          if (!hay.includes(q)) return false;
        }
        return true;
      });
      switch (state.sort) {
        case 'hot': filtered.sort((a,b)=> (b._clicks + (b.score||0)) - (a._clicks + (a.score||0))); break;
        case 'alpha': filtered.sort((a,b)=> (new Date(b.updatedAt||0)) - (new Date(a.updatedAt||0))); break;
        case 'az': filtered.sort((a,b)=> a.name.localeCompare(b.name)); break;
      }
    }

    function render() {
      const start = (state.page - 1) * PAGE_SIZE;
      const page = filtered.slice(start, start + PAGE_SIZE);
      if (page.length === 0) {
        elTopics.innerHTML = `
          <div class="col-span-full text-white/70 space-y-3">
            <div>No topics found.</div>
            <button id="resetBtn" class="btn">Clear filters</button>
          </div>`;
        document.getElementById('resetBtn').addEventListener('click', () => {
          state.q = ''; state.cat = 'all'; state.sort = 'hot'; state.page = 1;
          elSearch.value = ''; elCat.value='all'; elSort.value='hot';
          apply(); render();
        });
      } else {
        elTopics.innerHTML = page.map(t => topicCard(t)).join('');
        bindCardActions();
      }
      const total = filtered.length;
      const pages = Math.max(1, Math.ceil(total / PAGE_SIZE));
      elInfo.textContent = `${total} topics`;
      elPrev.disabled = state.page <= 1;
      elNext.disabled = state.page >= pages;
      sync();
    }

    function topicCard(t) {
      const updated = t.updatedAt ? new Date(t.updatedAt).toLocaleDateString() : '‚Äî';
      const hasHashtag = !!t.hashtag;
      const hasKeyword = !!t.keyword;
      const hasAccounts = (t.accounts && t.accounts.length);
      const qLabel = hasHashtag ? t.hashtag : (hasKeyword ? t.keyword : t.name);
      const qUrl = searchUrl(t);
      return `
        <article class="rounded-lg border border-white/10 bg-[#0f1422] p-4 hover:shadow-glow transition-shadow">
          <div class="flex items-start justify-between gap-2">
            <div>
              <h3 class="text-base font-semibold">${escapeHtml(t.name)}</h3>
              <div class="text-xs text-white/60 flex flex-wrap items-center gap-2 mt-1">
                <span class="chip">${escapeHtml(t.category)}</span>
                <span class="chip">Updated: ${escapeHtml(updated)}</span>
                ${t._clicks ? `<span class="chip">Clicks: ${t._clicks}</span>` : ''}
              </div>
            </div>
            <button class="btn copy" data-id="${escapeHtml(t.id)}" data-url="${escapeHtml(qUrl)}">Copy search</button>
          </div>
          <p class="text-white/80 text-sm mt-3">${escapeHtml(t.description || '')}</p>
          <div class="mt-3 flex flex-wrap gap-2">
            <a class="btn open" data-id="${escapeHtml(t.id)}" href="${escapeHtml(qUrl)}" target="_blank" rel="noopener">Open X search: ${escapeHtml(qLabel)}</a>
            ${hasAccounts ? t.accounts.map(a => `<a class="btn acct" data-id="${escapeHtml(t.id)}" href="${escapeHtml(accountUrl(a))}" target="_blank" rel="noopener">@${escapeHtml(a.replace(/^@/, ''))}</a>`).join('') : ''}
          </div>
          ${t.examples && t.examples.length ? `<div class="mt-3 text-xs text-white/60">Examples: ${t.examples.map(e=>`<span class="chip">#${escapeHtml(e)}</span>`).join(' ')}</div>` : ''}
        </article>
      `;
    }

    function bindCardActions() {
      const clicks = JSON.parse(localStorage.getItem('x_clicks') || '{}');
      document.querySelectorAll('a.open, a.acct').forEach(a => {
        a.addEventListener('click', () => {
          const id = a.getAttribute('data-id');
          clicks[id] = (clicks[id] || 0) + 1;
          localStorage.setItem('x_clicks', JSON.stringify(clicks));
          const t = TOPICS.find(x => x.id === id); if (t) t._clicks = clicks[id];
        });
      });
      document.querySelectorAll('button.copy').forEach(btn => {
        btn.addEventListener('click', async () => {
          try { await navigator.clipboard.writeText(btn.getAttribute('data-url')); btn.textContent = 'Copied!'; setTimeout(()=>btn.textContent='Copy search',1200); }
          catch { btn.textContent = 'Copy failed'; setTimeout(()=>btn.textContent='Copy search',1200); }
        });
      });
    }

    // Events
    elSearch.addEventListener('input', () => { state.q = elSearch.value; state.page = 1; apply(); render(); });
    elCat.addEventListener('change', () => { state.cat = elCat.value; state.page = 1; apply(); render(); });
    elSort.addEventListener('change', () => { state.sort = elSort.value; state.page = 1; apply(); render(); });
    document.getElementById('reset').addEventListener('click', () => { state.q=''; state.cat='all'; state.sort='hot'; state.page=1; elSearch.value=''; elCat.value='all'; elSort.value='hot'; apply(); render(); });
    elPrev.addEventListener('click', () => { if (state.page > 1) { state.page--; render(); } });
    elNext.addEventListener('click', () => { const pages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE)); if (state.page < pages) { state.page++; render(); } });

    window.addEventListener('keydown', (e) => {
      const active = document.activeElement;
      if (e.key === '/' && (!active || (active.tagName !== 'INPUT' && active.tagName !== 'TEXTAREA'))) { e.preventDefault(); elSearch.focus(); }
      if (e.key === 'ArrowLeft') { if (state.page > 1) { state.page--; render(); } }
      if (e.key === 'ArrowRight') { const pages = Math.max(1, Math.ceil(filtered.length / PAGE_SIZE)); if (state.page < pages) { state.page++; render(); } }
    });

    load();
  </script>
</body>
</html>
