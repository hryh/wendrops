<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Airdrop Hub ‚Äî Neon Dark</title>

  <!-- Inline emoji favicon to avoid /favicon.ico 404 -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext x='50%25' y='50%25' dy='.35em' text-anchor='middle'%3EüöÄ%3C/text%3E%3C/svg%3E" />

  <!-- Tailwind CDN is fine for now; warning is only about production best practices -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Optional Tailwind config for a neon-dark vibe
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            bg: '#0b0f1a',
            card: '#12192a',
            edge: '#1e2a44',
            accent: '#22d3ee'
          },
          boxShadow: {
            neon: '0 0 0.5rem rgba(34,211,238,0.45), 0 0 1.25rem rgba(34,211,238,0.25)'
          }
        }
      }
    }
  </script>
  <style>
    :root { color-scheme: dark; }
    html, body { background: #0b0f1a; }
  </style>
</head>
<body class="min-h-screen text-white bg-[color:var(--bg,#0b0f1a)]">
  <header class="border-b border-white/10 sticky top-0 z-40 backdrop-blur bg-black/30">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
      <div class="flex items-center gap-2">
        <span class="text-cyan-300">AD</span>
        <h1 class="text-lg sm:text-xl font-semibold">Airdrop Hub</h1>
      </div>
      <nav class="flex items-center gap-4 text-sm">
        <a href="#" id="btnSubmit" class="text-white/80 hover:text-white">Submit</a>
        <a href="#" class="text-white/60 hover:text-white">Terms</a>
        <a href="#" class="text-white/60 hover:text-white">RSS</a>
        <button id="toggleTheme" class="ml-2 px-3 py-1 rounded border border-white/10 hover:border-white/25 text-white/80">Toggle Theme</button>
      </nav>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <!-- Filters -->
    <section class="grid sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4">
      <div>
        <label class="block text-xs text-white/60 mb-1">All Status</label>
        <div class="flex flex-wrap gap-2">
          <button data-status="all" class="statusBtn px-3 py-1 rounded bg-white/5 border border-white/10">All</button>
          <button data-status="live" class="statusBtn px-3 py-1 rounded bg-white/5 border border-white/10">Live</button>
          <button data-status="upcoming" class="statusBtn px-3 py-1 rounded bg-white/5 border border-white/10">Upcoming</button>
          <button data-status="ended" class="statusBtn px-3 py-1 rounded bg-white/5 border border-white/10">Ended</button>
        </div>
      </div>

      <div>
        <label class="block text-xs text-white/60 mb-1">All Chains</label>
        <select id="chainFilter" class="w-full bg-white/5 border border-white/10 rounded px-3 py-2">
          <option value="all">All</option>
          <option>Ethereum</option>
          <option>Solana</option>
          <option>Arbitrum</option>
          <option>Base</option>
          <option>Polygon</option>
          <option>Aptos</option>
          <option>BNB</option>
        </select>
      </div>

      <div>
        <label class="block text-xs text-white/60 mb-1">Sort</label>
        <select id="sortBy" class="w-full bg-white/5 border border-white/10 rounded px-3 py-2">
          <option value="deadlineAsc">Deadline ‚Üë</option>
          <option value="deadlineDesc">Deadline ‚Üì</option>
          <option value="rewardDesc">Reward ‚Üì</option>
          <option value="rewardAsc">Reward ‚Üë</option>
          <option value="popularityDesc">Popularity ‚Üì</option>
        </select>
      </div>

      <div class="flex items-end justify-between gap-2">
        <button id="resetBtn" class="h-10 px-3 rounded border border-white/10 bg-white/5">Reset</button>
        <label class="flex items-center gap-2 text-sm">
          <input id="favoritesOnly" type="checkbox" class="accent-cyan-400">
          <span>Show Favorites</span>
        </label>
      </div>
    </section>

    <!-- Search -->
    <section class="mb-4">
      <input id="searchInput" placeholder="Search airdrops..." class="w-full bg-white/5 border border-white/10 rounded px-3 py-2" />
    </section>

    <!-- Cards -->
    <section id="cards" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[120px]">
      <!-- Populated by JS -->
    </section>

    <!-- Pagination -->
    <section class="flex items-center justify-between mt-6">
      <button id="prevBtn" class="px-3 py-1 rounded border border-white/10 bg-white/5">Prev</button>
      <div id="pageInfo" class="text-white/60 text-sm">0 results</div>
      <button id="nextBtn" class="px-3 py-1 rounded border border-white/10 bg-white/5">Next</button>
    </section>

    <!-- Safety Tips -->
    <section class="mt-10">
      <h2 class="text-white/80 font-semibold mb-2">Safety Tips</h2>
      <ul class="list-disc ml-6 text-white/70 space-y-1 text-sm">
        <li>Only use official links. Double-check domains.</li>
        <li>Never share seed phrases or private keys.</li>
        <li>Use a burner wallet for testing unknown dApps.</li>
        <li>Beware of ‚Äúsupport‚Äù DMs. Verify before signing.</li>
      </ul>
    </section>

    <footer class="mt-10 text-white/60 text-sm">
      <p>Built for learning. Data is sample only. Always DYOR. ‚Ä¢ <a href="#" class="underline">Terms</a> ‚Ä¢ <a href="#" class="underline">Submit</a> ‚Ä¢ <a href="#" class="underline">RSS</a></p>
    </footer>
  </main>

  <script>
    // -----------------------
    // App State
    // -----------------------
    let AIRDROPS = [];
    let filtered = [];
    let favorites = new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));
    let state = {
      status: 'all',
      chain: 'all',
      sortBy: 'deadlineAsc',
      search: '',
      page: 1,
      pageSize: 9,
      favoritesOnly: false
    };

    // -----------------------
    // Helpers
    // -----------------------
    function fmtDate(iso) {
      try {
        const d = new Date(iso + 'T00:00:00Z');
        return d.toLocaleDateString();
      } catch { return iso; }
    }
    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // -----------------------
    // Data Load (PATH HERE)
    // -----------------------
    async function loadData() {
      try {
        // IMPORTANT: This must match your file location.
        // Your JSON should be at repo path: data/data.json
        const res = await fetch('data/data.json', { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
        const txt = await res.text();

        try {
          AIRDROPS = JSON.parse(txt);
        } catch (e) {
          console.error('JSON parse error. Raw response:', txt);
          throw new Error('Invalid JSON format');
        }

        render();
        handleDeepLinkOnLoad();
      } catch (e) {
        console.error('Failed to load data:', e);
        document.getElementById('cards').innerHTML =
          `<p class="text-white/70">Failed to load data: ${escapeHtml(e.message)}</p>`;
        document.getElementById('pageInfo').textContent = '0 results';
      }
    }

    // -----------------------
    // Rendering
    // -----------------------
    function applyFilters() {
      const q = state.search.trim().toLowerCase();
      filtered = AIRDROPS.filter(x => {
        if (state.status !== 'all' && x.status !== state.status) return false;
        if (state.chain !== 'all' && x.chain !== state.chain) return false;
        if (state.favoritesOnly && !favorites.has(x.id)) return false;
        if (q) {
          const hay = `${x.name} ${x.id} ${x.chain} ${x.tags?.join(' ') ?? ''}`.toLowerCase();
          if (!hay.includes(q)) return false;
        }
        return true;
      });

      switch (state.sortBy) {
        case 'deadlineAsc':
          filtered.sort((a,b)=>a.deadline.localeCompare(b.deadline)); break;
        case 'deadlineDesc':
          filtered.sort((a,b)=>b.deadline.localeCompare(a.deadline)); break;
        case 'rewardDesc':
          filtered.sort((a,b)=>(b.rewardUSD??0)-(a.rewardUSD??0)); break;
        case 'rewardAsc':
          filtered.sort((a,b)=>(a.rewardUSD??0)-(b.rewardUSD??0)); break;
        case 'popularityDesc':
          filtered.sort((a,b)=>(b.popularity??0)-(a.popularity??0)); break;
      }
    }

    function render() {
      applyFilters();

      const start = (state.page - 1) * state.pageSize;
      const pageItems = filtered.slice(start, start + state.pageSize);
      const cards = document.getElementById('cards');

      if (pageItems.length === 0) {
        cards.innerHTML = `<div class="col-span-full text-white/60">0 results</div>`;
      } else {
        cards.innerHTML = pageItems.map(x => cardHtml(x)).join('');
      }

      const total = filtered.length;
      const totalPages = Math.max(1, Math.ceil(total / state.pageSize));
      document.getElementById('pageInfo').textContent = `${total} results`;
      document.getElementById('prevBtn').disabled = state.page <= 1;
      document.getElementById('nextBtn').disabled = state.page >= totalPages;
    }

    function cardHtml(x) {
      const fav = favorites.has(x.id);
      return `
        <article class="rounded-lg border border-white/10 bg-[${'#12192a'}] p-4 hover:shadow-neon transition-shadow">
          <div class="flex items-start justify-between gap-3">
            <div>
              <h3 class="text-base font-semibold">${escapeHtml(x.name)}</h3>
              <div class="text-xs text-white/60">${escapeHtml(x.chain)} ‚Ä¢ ${escapeHtml(x.status)}</div>
            </div>
            <button data-fav="${escapeHtml(x.id)}" class="text-sm px-2 py-1 rounded border ${fav ? 'border-cyan-400 text-cyan-300' : 'border-white/10 text-white/70'}">
              ${fav ? '‚òÖ' : '‚òÜ'}
            </button>
          </div>

          <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
            <div class="bg-white/5 rounded p-2">
              <div class="text-white/60 text-xs">Reward</div>
              <div class="font-medium">$${Number(x.rewardUSD ?? 0)}</div>
            </div>
            <div class="bg-white/5 rounded p-2">
              <div class="text-white/60 text-xs">Deadline</div>
              <div class="font-medium">${escapeHtml(fmtDate(x.deadline))}</div>
            </div>
          </div>

          <ul class="mt-3 text-sm list-disc ml-5 text-white/80">
            ${(x.tasks ?? []).slice(0,3).map(t=>`<li>${escapeHtml(t)}</li>`).join('')}
          </ul>

          <div class="mt-3 flex flex-wrap gap-2">
            ${(x.tags ?? []).map(tag => `<span class="text-xs px-2 py-1 rounded bg-white/5 border border-white/10">${escapeHtml(tag)}</span>`).join('')}
          </div>

          <div class="mt-4 flex items-center gap-2 text-sm">
            ${x?.links?.site ? `<a class="underline text-cyan-300" href="${escapeHtml(x.links.site)}" target="_blank" rel="noopener">Site</a>` : ''}
            ${x?.links?.twitter ? `<a class="underline text-cyan-300" href="${escapeHtml(x.links.twitter)}" target="_blank" rel="noopener">Twitter</a>` : ''}
            ${x?.links?.docs ? `<a class="underline text-cyan-300" href="${escapeHtml(x.links.docs)}" target="_blank" rel="noopener">Docs</a>` : ''}
          </div>
        </article>
      `;
    }

    // -----------------------
    // Events
    // -----------------------
    function bindEvents() {
      document.querySelectorAll('.statusBtn').forEach(btn => {
        btn.addEventListener('click', () => {
          state.status = btn.dataset.status;
          state.page = 1;
          render();
        });
      });

      document.getElementById('chainFilter').addEventListener('change', e => {
        state.chain = e.target.value;
        state.page = 1;
        render();
      });

      document.getElementById('sortBy').addEventListener('change', e => {
        state.sortBy = e.target.value;
        state.page = 1;
        render();
      });

      document.getElementById('resetBtn').addEventListener('click', () => {
        state = { status:'all', chain:'all', sortBy:'deadlineAsc', search:'', page:1, pageSize:9, favoritesOnly:false };
        document.getElementById('chainFilter').value = 'all';
        document.getElementById('sortBy').value = 'deadlineAsc';
        document.getElementById('searchInput').value = '';
        document.getElementById('favoritesOnly').checked = false;
        render();
      });

      document.getElementById('favoritesOnly').addEventListener('change', e => {
        state.favoritesOnly = e.target.checked;
        state.page = 1;
        render();
      });

      document.getElementById('searchInput').addEventListener('input', e => {
        state.search = e.target.value;
        state.page = 1;
        render();
      });

      document.getElementById('prevBtn').addEventListener('click', () => {
        if (state.page > 1) { state.page--; render(); }
      });
      document.getElementById('nextBtn').addEventListener('click', () => {
        const totalPages = Math.max(1, Math.ceil(filtered.length / state.pageSize));
        if (state.page < totalPages) { state.page++; render(); }
      });

      document.getElementById('cards').addEventListener('click', e => {
        const btn = e.target.closest('button[data-fav]');
        if (!btn) return;
        const id = btn.getAttribute('data-fav');
        if (favorites.has(id)) favorites.delete(id); else favorites.add(id);
        localStorage.setItem('favorites', JSON.stringify([...favorites]));
        render();
      });

      document.getElementById('toggleTheme').addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
      });
    }

    // -----------------------
    // Deep link support
    // -----------------------
    function handleDeepLinkOnLoad() {
      const hash = location.hash.slice(1);
      if (!hash) return;
      const params = new URLSearchParams(hash);
      const id = params.get('id');
      if (!id) return;
      const el = [...document.querySelectorAll('[data-fav]')].find(b => b.getAttribute('data-fav') === id);
      if (el) el.scrollIntoView({ behavior:'smooth', block:'center' });
    }

    // -----------------------
    // Init
    // -----------------------
    bindEvents();
    loadData();
  </script>
</body>
</html>