<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WENDROPS — Discover & Track Crypto Airdrops</title>
  <meta name="description" content="Discover the latest crypto airdrops across multiple blockchains. Track live, upcoming, and ended airdrops with detailed information and tutorials." />
  <meta name="keywords" content="crypto airdrops, blockchain, ethereum, solana, arbitrum, base, polygon, aptos, bnb, defi, nft" />
  <meta property="og:title" content="WENDROPS — Discover & Track Crypto Airdrops" />
  <meta property="og:description" content="Discover the latest crypto airdrops across multiple blockchains. Track live, upcoming, and ended airdrops with detailed information and tutorials." />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="WENDROPS — Discover & Track Crypto Airdrops" />
  <meta name="twitter:description" content="Discover the latest crypto airdrops across multiple blockchains. Track live, upcoming, and ended airdrops with detailed information and tutorials." />
  
  <!-- Manifest is served under /manifest.webmanifest in this project; remove broken link -->
  <link rel="dns-prefetch" href="https://api.twitter.com">
  <link rel="preconnect" href="https://api.twitter.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "WENDROPS",
    "url": "https://wendrops-airdrop.vercel.app/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://wendrops-airdrop.vercel.app/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  
  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          colors: { 
            bg: '#0a0e1a', 
            card: '#111827', 
            edge: '#1f2937', 
            accent: '#3b82f6',
            accentHover: '#2563eb',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444'
          },
          boxShadow: { 
            glow: '0 0 20px rgba(59, 130, 246, 0.15), 0 0 40px rgba(59, 130, 246, 0.1)',
            card: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
            cardHover: '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)'
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.3s ease-out',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  <style>
    :root { 
      color-scheme: dark; 
      --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      --gradient-secondary: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }
    
    html, body { 
      background: linear-gradient(135deg, #0a0e1a 0%, #111827 100%);
      min-height: 100vh;
    }
    
    .btn { 
      padding: 0.5rem 1rem; 
      border-radius: 0.75rem; 
      border: 1px solid rgba(255,255,255,0.1); 
      background: rgba(255,255,255,0.05); 
      transition: all 0.2s ease;
      font-weight: 500;
    }
    .btn:hover { 
      border-color: rgba(59, 130, 246, 0.5); 
      background: rgba(59, 130, 246, 0.1);
      transform: translateY(-1px);
    }
    .btn-primary {
      background: var(--gradient-primary);
      border-color: #3b82f6;
      color: white;
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
      transform: translateY(-1px);
    }
    
    .chip { 
      font-size: 0.75rem; 
      padding: 0.375rem 0.75rem; 
      border-radius: 0.5rem; 
      background: rgba(255,255,255,0.08); 
      border: 1px solid rgba(255,255,255,0.15);
      font-weight: 500;
      transition: all 0.2s ease;
    }
    .chip:hover {
      background: rgba(255,255,255,0.12);
      transform: scale(1.05);
    }
    
    .hidden { display: none; }
    .callout { background: linear-gradient(135deg, rgba(34,211,238,0.08), rgba(59,130,246,0.08)); border: 1px solid rgba(255,255,255,0.12); }
    .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.1), rgba(255,255,255,0.06)); background-size: 200% 100%; animation: shine 1.2s linear infinite; }
    @keyframes shine { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
  </style>
  <script>
    const YOUR_SECRET_TOKEN = 'betahryh12';
    const WHITEPAPER_URL = 'https://spangle-cheshire-e55.notion.site/Airdrop-Hub-Whitepaper-f939112946de41009c58280d42d870dc';

    (function () {
      try {
        const saved = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const mode = saved || (prefersDark ? 'dark' : 'light');
        document.documentElement.classList.toggle('dark', mode === 'dark');
      } catch {}
    })();

    (function () {
      try {
        const params = new URLSearchParams(location.search);
        const token = params.get('token');
        if (token && token === YOUR_SECRET_TOKEN) {
          localStorage.setItem('owner_access', 'true');
          const url = new URL(location.href);
          url.searchParams.delete('token');
          history.replaceState({}, '', url.toString());
        }
      } catch {}
    })();
  </script>
</head>
<body class="min-h-screen text-white relative overflow-x-hidden">
  <!-- Background Orbs / Grid -->
  <div aria-hidden="true" class="pointer-events-none absolute inset-0 -z-10">
    <div class="absolute -top-24 -right-16 w-[38rem] h-[38rem] rounded-full blur-3xl opacity-20" style="background: radial-gradient(circle at 30% 30%, rgba(59,130,246,0.6), transparent 60%);"></div>
    <div class="absolute -bottom-24 -left-16 w-[34rem] h-[34rem] rounded-full blur-3xl opacity-20" style="background: radial-gradient(circle at 70% 70%, rgba(16,185,129,0.5), transparent 60%);"></div>
    <div class="absolute inset-0 opacity-[0.06]" style="background-image: linear-gradient(rgba(255,255,255,0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.08) 1px, transparent 1px); background-size: 24px 24px;"></div>
  </div>

  <header class="sticky top-0 z-40 bg-black/40 backdrop-blur-xl border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-4">
      <div class="flex items-center gap-2">
          <img src="/favicon.svg" alt="WENDROPS" class="w-8 h-8 rounded-lg shadow-glow" />
          <h1 class="text-lg sm:text-xl font-semibold tracking-tight">WENDROPS</h1>
          <span class="ml-2 text-xs text-white/50">Pro</span>
        </div>
        <a href="https://spangle-cheshire-e55.notion.site/Airdrop-Hub-Whitepaper-f939112946de41009c58280d42d870dc" target="_blank" rel="noopener" class="text-cyan-300 hover:text-white underline text-sm">Whitepaper</a>
      </div>
      <nav class="flex items-center gap-2 text-sm">
        <a href="index.html" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition">Home</a>
        <a href="wallet-analysis-v4.html" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition">Wallet Analysis</a>
        <a href="points-system-v4.html" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition">Points System</a>
        <a href="terms.html" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition">Terms</a>
        <button id="toggleTheme" class="px-3 py-1.5 rounded-lg border border-white/10 hover:border-white/20 bg-white/5 hover:bg-white/10 transition ml-1 text-white/80">Toggle Theme</button>
      </nav>
    </div>
  </header>

  <!-- Notification System -->
  <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

  <!-- Floating Points Widget -->
  <div id="pointsWidget" class="hidden fixed right-4 bottom-4 z-40">
    <div class="rounded-xl border border-white/10 bg-black/50 backdrop-blur px-4 py-3 shadow-glow">
      <div class="text-xs text-white/60">Your Points</div>
      <div id="pointsWidgetValue" class="text-2xl font-bold">0</div>
      <div id="pointsWidgetAddr" class="text-[11px] text-white/50 mt-1">-</div>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <!-- Hero -->
    <section class="relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-6 sm:p-8 mb-6">
      <div class="absolute right-0 top-0 h-full w-1/2 opacity-20 blur-2xl" style="background: radial-gradient( circle at 30% 50%, rgba(59,130,246,0.5), transparent 50% );"></div>
      <div class="relative z-10 grid md:grid-cols-2 gap-6 items-center">
        <div>
          <div class="inline-flex items-center gap-2 px-2.5 py-1 rounded-full border border-cyan-400/30 bg-cyan-400/10 text-cyan-300 text-xs">Crypto-Native Discovery · Multi-Chain</div>
          <h2 class="mt-3 text-2xl sm:text-4xl font-extrabold tracking-tight">Discover, qualify and track airdrops like a pro.</h2>
          <p class="mt-3 text-white/70">Premium dark UI, on-chain analytics, quests, and a public leaderboard. Built for explorers who want signal over noise.</p>
          <div class="mt-5 flex flex-wrap gap-3">
            <a href="wallet-analysis-v4.html" class="btn-primary px-5 py-2.5 text-sm font-semibold rounded-xl">Analyze Wallet</a>
            <a href="points-system-v4.html" class="px-5 py-2.5 text-sm font-semibold rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition">Earn Points</a>
          </div>
        </div>
        <div class="hidden md:block">
          <div class="rounded-xl border border-white/10 bg-black/30 p-4 shadow-glow">
            <div class="grid grid-cols-2 gap-3 text-sm">
              <div class="rounded-lg bg-white/5 p-3">
                <div class="text-white/60">Chains</div>
                <div class="text-xl font-semibold">7+</div>
              </div>
              <div class="rounded-lg bg-white/5 p-3">
                <div class="text-white/60">Airdrops</div>
                <div class="text-xl font-semibold">1000+</div>
              </div>
              <div class="rounded-lg bg-white/5 p-3">
                <div class="text-white/60">Quests</div>
                <div class="text-xl font-semibold">Daily</div>
              </div>
              <div class="rounded-lg bg-white/5 p-3">
                <div class="text-white/60">Leaderboard</div>
                <div class="text-xl font-semibold">Live</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Daily Picks -->
    <section id="dailyPicksSection" class="mb-6 hidden">
      <div class="flex items-center justify-between">
        <h2 class="text-white/80 font-semibold mb-3">Daily Picks</h2>
      </div>
      <div id="dailyPicks" class="grid sm:grid-cols-3 gap-4"></div>
    </section>

    <!-- Filters row -->
    <section class="grid sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4">
      <div>
        <label class="block text-xs text-white/60 mb-1">All Status</label>
        <div class="flex flex-wrap gap-2">
          <button data-status="all" class="statusBtn btn">All</button>
          <button data-status="live" class="statusBtn btn">Live</button>
          <button data-status="upcoming" class="statusBtn btn">Upcoming</button>
          <button data-status="ended" class="statusBtn btn">Ended</button>
        </div>
      </div>
      <div>
        <label class="block text-xs text-white/60 mb-1">All Chains</label>
        <select id="chainFilter" class="w-full btn">
          <option value="all">All</option>
          <option>Ethereum</option>
          <option>Solana</option>
          <option>Arbitrum</option>
          <option>Base</option>
          <option>Polygon</option>
          <option>Aptos</option>
          <option>BNB</option>
        </select>
      </div>
      <div>
        <label class="block text-xs text-white/60 mb-1">Sort</label>
        <select id="sortBy" class="w-full btn">
          <option value="deadlineAsc">Deadline ↑</option>
          <option value="deadlineDesc">Deadline ↓</option>
          <option value="rewardDesc">Reward ↓</option>
          <option value="rewardAsc">Reward ↑</option>
          <option value="popularityDesc">Popularity ↓</option>
        </select>
      </div>
      <div class="flex items-end justify-between gap-2">
        <button id="resetBtn" class="btn">Reset</button>
        <label class="flex items-center gap-2 text-sm">
          <input id="favoritesOnly" type="checkbox" class="accent-cyan-400">
          <span>Show Favorites</span>
        </label>
      </div>
    </section>

    <!-- Search -->
    <section class="mb-4">
      <input id="searchInput" placeholder="Search airdrops..." class="w-full btn" />
    </section>

    <!-- Cards -->
    <section id="cards" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 min-h-[120px]"></section>

    <!-- Pagination -->
    <section class="flex items-center justify-between mt-6">
      <button id="prevBtn" class="btn">Prev</button>
      <div id="pageInfo" class="text-white/60 text-sm">0 results</div>
      <button id="nextBtn" class="btn">Next</button>
    </section>

    <!-- Whitepaper callout -->
    <section class="mt-10 p-4 rounded-lg callout">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
        <div>
          <h2 class="text-white/90 font-semibold">Read the Whitepaper</h2>
          <p class="text-white/70 text-sm mt-1">Executive summary, product overview, anti-Sybil scoring, and token buyback policy.</p>
        </div>
        <a class="btn-primary px-6 py-3 text-lg font-semibold" href="https://spangle-cheshire-e55.notion.site/Airdrop-Hub-Whitepaper-f939112946de41009c58280d42d870dc" target="_blank" rel="noopener">
          Read Whitepaper
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
          </svg>
        </a>
      </div>
    </section>

    <!-- Safety Tips -->
    <section class="mt-10">
      <h2 class="text-white/80 font-semibold mb-2">Safety Tips</h2>
      <ul class="list-disc ml-6 text-white/70 space-y-1 text-sm">
        <li>Only use official links. Double-check domains.</li>
        <li>Never share seed phrases or private keys.</li>
        <li>Use a burner wallet for testing unknown dApps.</li>
        <li>Beware of “support” DMs. Verify before signing.</li>
      </ul>
    </section>

    <footer class="mt-16 pt-8 border-t border-white/10">
      <div class="max-w-6xl mx-auto px-2 sm:px-0">
        <div class="flex flex-col sm:flex-row items-center justify-between gap-3 text-sm text-white/60">
          <p>© 2025 WENDROPS. All rights reserved.</p>
          <div class="flex items-center gap-4">
            <a class="hover:text-white" href="terms.html">Terms</a>
            <a class="hover:text-white" href="points-system-v4.html">Leaderboard</a>
            <a class="hover:text-white" href="wallet-analysis-v4.html">Wallet Analysis</a>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <!-- Tutorial modal -->
  <div id="tutorialModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden items-center justify-center p-4 z-50">
    <div class="w-full max-w-4xl h-[80vh] bg-[#0f1422] border border-white/10 rounded-lg overflow-hidden flex flex-col">
      <div class="flex items-center justify-between p-3 border-b border-white/10">
        <h3 id="tutorialTitle" class="font-semibold">Tutorial</h3>
        <div class="flex items-center gap-2">
          <a id="openInNewTab" href="#" target="_blank" rel="noopener" class="btn text-cyan-300">Open in new tab</a>
          <button id="closeTutorial" class="btn">Close</button>
        </div>
      </div>
      <iframe id="tutorialFrame" class="flex-1 w-full" src="about:blank" sandbox="allow-scripts allow-popups allow-forms"></iframe>
      <div id="notionNotice" class="p-2 text-xs text-white/70 border-t border-white/10 hidden">Opened in a new tab because the source blocks embedding (CSP frame-ancestors).</div>
    </div>
  </div>

  <!-- Coach modal -->
  <div id="coachModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden items-center justify-center p-4 z-50">
    <div class="w-full max-w-xl bg-[#0f1422] border border-white/10 rounded-lg overflow-hidden">
      <div class="flex items-center justify-between p-3 border-b border-white/10">
        <h3 id="coachTitle" class="font-semibold">Activity Coach</h3>
        <button id="coachClose" class="btn">Close</button>
      </div>
      <div class="p-4 text-sm">
        <div id="coachContent" class="space-y-2"></div>
        <p id="coachHint" class="text-white/60 text-xs mt-3"></p>
      </div>
    </div>
  </div>

  <script>
    // Register service worker for offline support
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(() => {});
      });
    }
    // Light mode inversion hack (quick white theme)
    const style = document.createElement('style');
    style.textContent = `
      html.light { filter: invert(1) hue-rotate(180deg); }
      html.light img, html.light video, html.light iframe { filter: invert(1) hue-rotate(180deg); }
    `;
    document.head.appendChild(style);

    (function showSubmitIfOwner() {
      try {
        const isOwner = localStorage.getItem('owner_access') === 'true';
        if (isOwner) document.getElementById('submitLink').classList.remove('hidden');
      } catch {}
    })();

    // Global theme toggle (persisted)
    (function initTheme() {
      try {
        const saved = localStorage.getItem('theme');
        if (saved === 'light') document.documentElement.classList.add('light');
      } catch {}
      const btn = document.getElementById('toggleTheme');
      if (btn) {
        btn.addEventListener('click', () => {
          const isLight = document.documentElement.classList.toggle('light');
          try { localStorage.setItem('theme', isLight ? 'light' : 'dark'); } catch {}
        });
      }
    })();

    // Floating points widget updater
    function updatePointsWidget() {
      try {
        const addr = localStorage.getItem('current_user_wallet');
        if (!addr) { document.getElementById('pointsWidget').classList.add('hidden'); return; }
        const user = JSON.parse(localStorage.getItem('user_' + addr) || '{}');
        const points = user.totalPoints ?? 0;
        const val = document.getElementById('pointsWidgetValue');
        const ad = document.getElementById('pointsWidgetAddr');
        if (val && ad) {
          val.textContent = String(points);
          ad.textContent = addr.slice(0,6) + '...' + addr.slice(-4);
        }
        document.getElementById('pointsWidget').classList.remove('hidden');
      } catch {}
    }
    window.addEventListener('storage', (e) => {
      if (e.key && (e.key.startsWith('user_') || e.key === 'current_user_wallet')) updatePointsWidget();
    });
    updatePointsWidget();

    function saveState() { try { localStorage.setItem('filters', JSON.stringify(state)); } catch {} }
    function restoreState() {
      try {
        const qs = new URLSearchParams(location.search);
        const saved = JSON.parse(localStorage.getItem('filters') || '{}');
        return {
          status: (qs.get('status') || saved.status || 'all'),
          chain: (qs.get('chain') || saved.chain || 'all'),
          sortBy: (qs.get('sort') || saved.sortBy || 'deadlineAsc'),
          search: (qs.get('q') || saved.search || ''),
          page: Number(qs.get('page') || saved.page || 1),
          pageSize: 9,
          favoritesOnly: (qs.get('fav') || saved.favoritesOnly) ? (qs.get('fav') === '1' || saved.favoritesOnly === true) : false
        };
      } catch { return { status: 'all', chain: 'all', sortBy: 'deadlineAsc', search: '', page: 1, pageSize: 9, favoritesOnly: false }; }
    }
    function syncQueryParams() {
      const url = new URL(location.href);
      url.searchParams.set('status', state.status);
      url.searchParams.set('chain', state.chain);
      url.searchParams.set('sort', state.sortBy);
      if (state.search) url.searchParams.set('q', state.search); else url.searchParams.delete('q');
      if (state.favoritesOnly) url.searchParams.set('fav', '1'); else url.searchParams.delete('fav');
      if (state.page > 1) url.searchParams.set('page', String(state.page)); else url.searchParams.delete('page');
      history.replaceState({}, '', url.toString());
    }

    function currentTheme() { return document.documentElement.classList.contains('dark') ? 'dark' : 'light'; }
    function setTheme(mode) { document.documentElement.classList.toggle('dark', mode === 'dark'); try { localStorage.setItem('theme', mode); } catch {} }
    const toggleTheme = document.getElementById('toggleTheme');
    if (toggleTheme) {
      toggleTheme.addEventListener('click', () => { setTheme(currentTheme() === 'dark' ? 'light' : 'dark'); });
    }

    let AIRDROPS = [];
    let filtered = [];
    let favorites = new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));
    let state = restoreState();
    let featured = [];

    function fmtDate(iso) { try { return new Date(iso + 'T00:00:00Z').toLocaleDateString(); } catch { return iso; } }
    function daysUntil(iso) { try { const now = new Date(); const end = new Date(iso + 'T23:59:59Z'); return Math.ceil((end - now)/(1000*60*60*24)); } catch { return null; } }
    function isNotionUrl(u) { try { const { hostname } = new URL(u); return /(^|\.)notion\.so$/.test(hostname) || /(^|\.)notion\.site$/.test(hostname) || /(^|\.)mail\.notion\.so$/.test(hostname) || /(^|\.)spangle-cheshire-e55\.notion\.site$/.test(hostname); } catch { return false; } }

    // EV helpers
    function computeEV(x, walletBoost = 0) {
      const baseVal = Number(x.baseEstTokenValue ?? 0);
      const pToken = clamp(Number(x.pToken ?? 0) + walletBoost, 0, 1);
      const pElig = clamp(Number(x.pEligibility ?? 0) + walletBoost, 0, 1);
      const gas = Number(x.estGasUSD ?? 0);
      const ev = (pToken * pElig * baseVal) - gas;
      const hours = Math.max(0.25, Number(x.estHours ?? 0) || 0.5);
      const evhr = ev / hours;
      return { ev, evhr };
    }
    function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

    // Wallet read-only integration
    const CHAINS = [
      { key: 'Ethereum', chainId: '0x1', rpc: 'https://cloudflare-eth.com' },
      { key: 'Arbitrum', chainId: '0xa4b1', rpc: 'https://arb1.arbitrum.io/rpc' },
      { key: 'Base', chainId: '0x2105', rpc: 'https://mainnet.base.org' },
      { key: 'Polygon', chainId: '0x89', rpc: 'https://polygon-rpc.com' }
    ];
    let wallet = { address: null, stats: {}, readiness: 0, lastChain: null };

    const walletBtn = document.getElementById('walletBtn');
    const walletInfo = document.getElementById('walletInfo');

    if (walletBtn) {
      walletBtn.addEventListener('click', connectWallet);
    }

    async function connectWallet() {
      if (!window.ethereum) { alert('No wallet found (MetaMask/Rabby). Read-only connect requires a browser wallet.'); return; }
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        wallet.address = accounts[0];
        walletInfo.textContent = `Connected: ${short(wallet.address)} ??Reading recent activity?�`;
        await readWalletStats();
        walletInfo.textContent = `Connected: ${short(wallet.address)} ??Readiness: ${(wallet.readiness*100).toFixed(0)}%`;
        renderFeatured(); render();
      } catch (e) {
        alert('Wallet connection failed: ' + (e.message || e));
      }
    }

    function short(addr){ return addr ? addr.slice(0,6)+'...'+addr.slice(-4) : ''; }

    async function readWalletStats() {
      const clicks = JSON.parse(localStorage.getItem('x_clicks') || '{}'); // just to show how we might mix signals later
      const stats = {};
      for (const c of CHAINS) {
        try {
          const [bal, txc] = await Promise.all([
            rpcCall(c.rpc, 'eth_getBalance', [wallet.address, 'latest']),
            rpcCall(c.rpc, 'eth_getTransactionCount', [wallet.address, 'latest'])
          ]);
          const balanceEth = Number(parseInt(bal, 16)) / 1e18;
          const txCount = parseInt(txc, 16);
          stats[c.key] = { balanceEth, txCount };
        } catch { stats[c.key] = { balanceEth: 0, txCount: 0 }; }
      }
      wallet.stats = stats;
      // Simple readiness score: having some tx history and small balances across chains
      const chainsActive = Object.values(stats).filter(s => s.txCount > 3).length;
      const hasGas = Object.values(stats).filter(s => s.balanceEth > 0.01).length;
      wallet.readiness = clamp((chainsActive*0.15 + hasGas*0.1), 0, 0.5); // up to +0.5 boost distributed
      try { localStorage.setItem('wallet_readiness', JSON.stringify({ addr: wallet.address, stats: wallet.stats, readiness: wallet.readiness, t: Date.now() })); } catch {}
    }

    async function rpcCall(rpc, method, params) {
      const res = await fetch(rpc, {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({ jsonrpc: '2.0', id: 1, method, params })
      });
      const json = await res.json();
      if (json.error) throw new Error(json.error.message);
      return json.result;
    }

    // Skeletons
    function showSkeletons() {
      const sk = Array.from({length: 6}).map(() => `
        <div class="rounded-lg border border-white/10 p-4">
          <div class="h-5 w-1/2 skeleton rounded mb-3"></div>
          <div class="grid grid-cols-2 gap-2">
            <div class="h-12 skeleton rounded"></div>
            <div class="h-12 skeleton rounded"></div>
          </div>
          <div class="h-4 w-2/3 skeleton rounded mt-3"></div>
          <div class="h-4 w-1/3 skeleton rounded mt-2"></div>
        </div>
      `).join('');
      document.getElementById('cards').innerHTML = sk;
    }

    let hotClicks = {}; // from Hot on X

    async function loadData() {
      try {
        showSkeletons();
        hotClicks = JSON.parse(localStorage.getItem('x_clicks') || '{}');

        const [apiRes, staticRes] = await Promise.all([
          fetch('/api/airdrops', { cache: 'no-store' }).catch(() => null),
          fetch('data/data.json', { cache: 'no-store' }).catch(() => null)
        ]);

        let apiAirdrops = [];
        if (apiRes && apiRes.ok) {
          const apiJson = await apiRes.json().catch(() => ({ success: false }));
          if (apiJson && apiJson.success && Array.isArray(apiJson.airdrops)) apiAirdrops = apiJson.airdrops;
        }

        let staticAirdrops = [];
        if (staticRes && staticRes.ok) {
          const txt = await staticRes.text();
          try { staticAirdrops = JSON.parse(txt); } catch {}
        }

        // Merge: prefer API versions, de-duplicate by id
        const byId = new Map();
        for (const it of staticAirdrops) { if (it && it.id) byId.set(it.id, it); }
        for (const it of apiAirdrops) { if (it && it.id) byId.set(it.id, it); }
        AIRDROPS = Array.from(byId.values());
        console.log('Merged airdrops:', AIRDROPS.length, { api: apiAirdrops.length, static: staticAirdrops.length });

        // Featured picks with manual order
        featured = AIRDROPS.filter(x => x.featured === true)
          .sort((a, b) => (a.featuredOrder ?? 999) - (b.featuredOrder ?? 999))
          .slice(0, 3);

        // Restore UI
        const chainEl = document.getElementById('chainFilter'); if (chainEl) chainEl.value = state.chain;
        const sortEl = document.getElementById('sortBy'); if (sortEl) sortEl.value = state.sortBy;
        const searchEl = document.getElementById('searchInput'); if (searchEl) searchEl.value = state.search;
        const favEl = document.getElementById('favoritesOnly'); if (favEl) favEl.checked = state.favoritesOnly;
        renderFeatured();
        render();
      } catch (e) {
        document.getElementById('cards').innerHTML = `<p class="text-white/70">Failed to load data: ${escapeHtml(e.message)}</p>`;
        document.getElementById('pageInfo').textContent = '0 results';
      }
    }

    function applyFilters() {
      const q = state.search.trim().toLowerCase();
      console.log('Applying filters to', AIRDROPS.length, 'airdrops');
      console.log('State:', state);
      filtered = AIRDROPS.filter(x => {
        if (state.status !== 'all' && x.status !== state.status) return false;
        if (state.chain !== 'all' && x.chain !== state.chain) return false;
        if (state.favoritesOnly && !favorites.has(x.id)) return false;
        if (q) {
          const hay = `${x.name} ${x.id} ${x.chain} ${(x.tags||[]).join(' ')}`.toLowerCase();
          if (!hay.includes(q)) return false;
        }
        return true;
      });

      switch (state.sortBy) {
        case 'deadlineAsc': filtered.sort((a,b)=>a.deadline.localeCompare(b.deadline)); break;
        case 'deadlineDesc': filtered.sort((a,b)=>b.deadline.localeCompare(a.deadline)); break;
        case 'rewardDesc': filtered.sort((a,b)=>(b.rewardUSD??0)-(a.rewardUSD??0)); break;
        case 'rewardAsc': filtered.sort((a,b)=>(a.rewardUSD??0)-(b.rewardUSD??0)); break;
        case 'popularityDesc': filtered.sort((a,b)=>(b.popularity??0)-(a.popularity??0)); break;
      }
      console.log('After filtering:', filtered.length, 'airdrops remain');
    }

    function renderFeatured() {
      const sec = document.getElementById('dailyPicksSection');
      const wrap = document.getElementById('dailyPicks');
      if (featured.length === 0) { sec.classList.add('hidden'); return; }
      sec.classList.remove('hidden');
      wrap.innerHTML = featured.map(x => cardHtml(x, true)).join('');
    }

    function urgencyBadge(iso) {
      try {
        const d = new Date(iso);
        const now = new Date();
        const diffTime = d - now;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        if (isNaN(diffDays)) return '';
        const urgent = diffDays <= 3;
        return `<span class="chip ${urgent ? 'border-red-400/40 text-red-300' : 'border-white/10 text-white/70'}">${diffDays <= 0 ? 'Ends today' : `Ends in ${diffDays} day${diffDays===1?'':'s'}`}</span>`;
      } catch {
        return '';
      }
    }
    function newBadge(addedDate) {
      try { 
        const d = new Date(addedDate); 
        const days = Math.floor((Date.now() - d.getTime())/(1000*60*60*24)); 
        if (days <= 7) return `<span class="chip border-green-400/40 text-green-300">New</span>`; 
      } catch {}
      return '';
    }
    function riskChips(risks) {
      if (!Array.isArray(risks) || risks.length === 0) return '';
      return risks.slice(0,3).map(r => {
        const t = String(r).toLowerCase();
        const cls = t.includes('phish') || t.includes('drainer') || t.includes('scam') ? 'border-red-400/40 text-red-300'
                  : t.includes('audit') || t.includes('new contract') ? 'border-yellow-400/40 text-yellow-300'
                  : 'border-white/10 text-white/70';
        return `<span class="chip ${cls}">${escapeHtml(r)}</span>`;
      }).join('');
    }

    function render() {
      applyFilters();
      console.log('Filtered airdrops:', filtered.length);
      const total = filtered.length;
      const totalPages = Math.max(1, Math.ceil(total / state.pageSize));
      // Clamp page into bounds
      if (state.page < 1) state.page = 1;
      if (state.page > totalPages) state.page = totalPages;
      const start = (state.page - 1) * state.pageSize;
      const items = filtered.slice(start, start + state.pageSize);
      console.log('Items to render:', items.length);
      const cards = document.getElementById('cards');

      if (items.length === 0) {
        cards.innerHTML = `
          <div class="col-span-full text-white/70 space-y-3">
            <div>0 results</div>
            <button id="clearFilters" class="btn">Clear filters</button>
          </div>`;
        document.getElementById('clearFilters').addEventListener('click', () => {
          state = { status: 'all', chain: 'all', sortBy: 'deadlineAsc', search: '', page: 1, pageSize: 9, favoritesOnly: false };
          document.getElementById('chainFilter').value = 'all';
          document.getElementById('sortBy').value = 'deadlineAsc';
          document.getElementById('searchInput').value = '';
          document.getElementById('favoritesOnly').checked = false;
          saveState(); syncQueryParams(); render();
        });
      } else {
        cards.innerHTML = items.map(x => cardHtml(x, false)).join('');
        bindInteractive(cards);
      }

      document.getElementById('pageInfo').textContent = `${total} results`;
      document.getElementById('prevBtn').disabled = state.page <= 1;
      document.getElementById('nextBtn').disabled = state.page >= totalPages;

      saveState(); syncQueryParams();
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function bindInteractive(scope) {
      scope.querySelectorAll('button[data-fav]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-fav');
          if (favorites.has(id)) favorites.delete(id); else favorites.add(id);
          localStorage.setItem('favorites', JSON.stringify([...favorites]));
          renderFeatured(); render();
        });
      });
      // Tutorial links: Notion fallback
      scope.querySelectorAll('a[data-tutorial]').forEach(a => {
        const url = a.getAttribute('href');
        const title = a.getAttribute('data-title') || 'Tutorial';
        if (isNotionUrl(url)) {
          a.setAttribute('target', '_blank');
          a.setAttribute('rel', 'noopener');
          a.classList.add('tooltip');
          a.setAttribute('data-tip', 'Opens in new tab (embedding blocked by source)');
          a.addEventListener('click', () => document.getElementById('notionNotice').classList.remove('hidden'));
        } else {
          a.addEventListener('click', (e) => { e.preventDefault(); openTutorialModal(url, title); });
        }
      });
      // Coach buttons
      scope.querySelectorAll('button[data-coach]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-coach');
          const item = AIRDROPS.find(x => x.id === id);
          openCoach(item);
        });
      });
      // Add to Run buttons
      scope.querySelectorAll('button[data-run]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-run');
          const runs = JSON.parse(localStorage.getItem('runs') || '[]');
          let run = runs.find(r => r.id === 'default');
          if (!run) { run = { id: 'default', name: 'My Run', items: [] }; runs.push(run); }
          if (!run.items.includes(id)) run.items.push(id);
          localStorage.setItem('runs', JSON.stringify(runs));
          btn.textContent = 'Added';
          setTimeout(()=>btn.textContent='Add to Run', 1200);
        });
      });
    }

    function cardHtml(x, isFeatured) {
      const fav = favorites.has(x.id);
      const badge = isFeatured ? `<span class="chip text-cyan-300 border-cyan-400/40">Featured${x.featuredOrder ? ` #${x.featuredOrder}` : ''}</span>` : '';
      const endsChip = x.deadline ? urgencyBadge(x.deadline) : '';
      return `
        <article class="rounded-lg border border-white/10 bg-[${'#0f1422'}] p-4 hover:shadow-glow transition-shadow" data-airdrop-id="${escapeHtml(x.id)}">
          <div class="flex items-start justify-between gap-3">
            <div class="flex flex-col gap-1">
              <h3 class="text-base font-semibold">${escapeHtml(x.name)}</h3>
              <div class="text-xs text-white/60">${escapeHtml(x.chain)} · ${escapeHtml(x.status)}</div>
              <div class="flex gap-2 mt-1">${badge}${endsChip ? `<span>${endsChip}</span>` : ''}</div>
            </div>
            <button data-fav="${escapeHtml(x.id)}" class="p-2 rounded-lg transition-all ${fav ? 'text-yellow-400 bg-yellow-400/10' : 'text-white/40 hover:text-yellow-400 hover:bg-yellow-400/10'}" title="Toggle favorite">
              <svg class="w-5 h-5" fill="${fav ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
              </svg>
            </button>
          </div>

          <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
            <div class="bg-white/5 rounded p-2">
              <div class="text-white/60 text-xs">Reward</div>
              <div class="font-medium">$${Number(x.rewardUSD ?? 0)}</div>
            </div>
            <div class="bg-white/5 rounded p-2">
              <div class="text-white/60 text-xs">Deadline</div>
              <div class="font-medium">${escapeHtml(fmtDate(x.deadline))}</div>
            </div>
          </div>

          <div class="mb-4">
            <h4 class="text-sm font-semibold text-white/80 mb-2">Tasks</h4>
            <ul class="text-sm text-white/70 space-y-1">
              ${(x.tasks ?? []).slice(0,3).map(t=>`<li class="flex items-center gap-2"><span class="w-1.5 h-1.5 bg-blue-400 rounded-full"></span>${escapeHtml(t)}</li>`).join('')}
          </ul>
          </div>

          <div class="flex flex-wrap gap-2 mb-4">
            ${(x.tags ?? []).map(tag => `<span class="chip text-xs">${escapeHtml(tag)}</span>`).join('')}
          </div>

          <div class="mt-4 flex flex-wrap items-center gap-3 text-sm">
            ${x?.links?.site ? `<a class="underline text-cyan-300" href="${escapeHtml(x.links.site)}" target="_blank" rel="noopener">Site</a>` : ''}
            ${x?.links?.twitter ? `<a class="underline text-cyan-300" href="${escapeHtml(x.links.twitter)}" target="_blank" rel="noopener">Twitter</a>` : ''}
            ${x?.links?.docs ? `<a class="underline text-cyan-300" href="${escapeHtml(x.links.docs)}" target="_blank" rel="noopener">Docs</a>` : ''}
            ${x?.links?.tutorial ? `<a class="underline text-cyan-300" href="${escapeHtml(x.links.tutorial)}" data-tutorial data-title="${escapeHtml(x.name)} Tutorial">Tutorial</a>` : ''}
          </div>
        </article>
      `;
    }

    // Pagination buttons
    const prevBtnEl = document.getElementById('prevBtn');
    const nextBtnEl = document.getElementById('nextBtn');
    if (prevBtnEl) prevBtnEl.addEventListener('click', () => { if (state.page > 1) { state.page--; render(); } });
    if (nextBtnEl) nextBtnEl.addEventListener('click', () => { const totalPages = Math.max(1, Math.ceil(filtered.length / state.pageSize)); if (state.page < totalPages) { state.page++; render(); } });

    // Keyboard shortcuts
    window.addEventListener('keydown', (e) => {
      const active = document.activeElement;
      if (e.key === '/' && (!active || (active.tagName !== 'INPUT' && active.tagName !== 'TEXTAREA'))) { e.preventDefault(); document.getElementById('searchInput').focus(); }
      if (e.key.toLowerCase() === 'f' && (!active || active.tagName !== 'INPUT')) {
        e.preventDefault();
        const chk = document.getElementById('favoritesOnly');
        chk.checked = !chk.checked;
        state.favoritesOnly = chk.checked;
        state.page = 1;
        render();
      }
      if (e.key === 'ArrowLeft') { if (state.page > 1) { state.page--; render(); } }
      if (e.key === 'ArrowRight') {
        const totalPages = Math.max(1, Math.ceil(filtered.length / state.pageSize));
        if (state.page < totalPages) { state.page++; render(); }
      }
    });

    // Filters bindings
    document.querySelectorAll('.statusBtn').forEach(btn => {
      btn.addEventListener('click', () => { state.status = btn.dataset.status; state.page = 1; render(); });
    });
    const chainFilter = document.getElementById('chainFilter');
    if (chainFilter) {
      chainFilter.addEventListener('change', e => { state.chain = e.target.value; state.page = 1; render(); });
    }
    const sortBy = document.getElementById('sortBy');
    if (sortBy) {
      sortBy.addEventListener('change', e => { state.sortBy = e.target.value; state.page = 1; render(); });
    }
    const resetBtn = document.getElementById('resetBtn');
    if (resetBtn) {
      resetBtn.addEventListener('click', () => {
      state = { status: 'all', chain: 'all', sortBy: 'deadlineAsc', search: '', page: 1, pageSize: 9, favoritesOnly: false };
        if (chainFilter) chainFilter.value = 'all';
        if (sortBy) sortBy.value = 'deadlineAsc';
        const searchInput = document.getElementById('searchInput');
        if (searchInput) searchInput.value = '';
        const favoritesOnly = document.getElementById('favoritesOnly');
        if (favoritesOnly) favoritesOnly.checked = false;
        // Reset status button styling
        document.querySelectorAll('.statusBtn').forEach(b => b.classList.remove('btn-primary'));
        const allStatusBtn = document.querySelector('[data-status="all"]');
        if (allStatusBtn) allStatusBtn.classList.add('btn-primary');
      render();
    });
    }
    const favoritesOnly = document.getElementById('favoritesOnly');
    if (favoritesOnly) {
      favoritesOnly.addEventListener('change', e => { state.favoritesOnly = e.target.checked; state.page = 1; render(); });
    }
    
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
      searchInput.addEventListener('input', e => { state.search = e.target.value; state.page = 1; render(); });
    }

    // Tutorial modal controls
    const modal = document.getElementById('tutorialModal');
    const frame = document.getElementById('tutorialFrame');
    const titleEl = document.getElementById('tutorialTitle');
    const openNew = document.getElementById('openInNewTab');
    const notionNotice = document.getElementById('notionNotice');
    const closeTutorial = document.getElementById('closeTutorial');
    if (closeTutorial) {
      closeTutorial.addEventListener('click', closeTutorialModal);
    }
    
    if (modal) {
    modal.addEventListener('click', (e) => { if (e.target === modal) closeTutorialModal(); });
    }
    function openTutorialModal(url, title) { notionNotice.classList.add('hidden'); titleEl.textContent = title || 'Tutorial'; frame.src = url; openNew.href = url; modal.classList.remove('hidden'); modal.classList.add('flex'); }
    function closeTutorialModal() { frame.src = 'about:blank'; modal.classList.add('hidden'); modal.classList.remove('flex'); }

    // Activity Coach modal
    const coachModal = document.getElementById('coachModal');
    const coachTitle = document.getElementById('coachTitle');
    const coachContent = document.getElementById('coachContent');
    const coachHint = document.getElementById('coachHint');
    
    const coachClose = document.getElementById('coachClose');
    if (coachClose) {
      coachClose.addEventListener('click', closeCoach);
    }
    
    if (coachModal) {
      coachModal.addEventListener('click', (e) => { if (e.target === coachModal) closeCoach(); });
    }
    function openCoach(item) {
      coachTitle.textContent = `${item.name} · Activity Coach`;
      const baseSteps = Array.isArray(item.coachSteps) ? item.coachSteps : [];
      const dynamic = [];
      // General hints
      if (item.tags?.includes('bridge')) dynamic.push('Bridge from a different source chain once to diversify flow.');
      if (item.chain) dynamic.push(`Do 3+ distinct txs on ${item.chain} over separate days to raise eligibility.`);
      dynamic.push(`Keep at least ~$5 gas on ${item.chain || 'the chain'} to avoid failed txs.`);
      const steps = [...baseSteps, ...dynamic].slice(0, 6);
      coachContent.innerHTML = steps.map(s => `<div class="flex items-start gap-2"><input type="checkbox" class="mt-1"/><span>${escapeHtml(s)}</span></div>`).join('');
      coachHint.textContent = 'Follow these steps to maximize your airdrop eligibility.';
      coachModal.classList.remove('hidden'); coachModal.classList.add('flex');
    }
    function closeCoach() { coachModal.classList.add('hidden'); coachModal.classList.remove('flex'); }

    // Notification system
    function showNotification(message, type = 'info', duration = 3000) {
      const container = document.getElementById('notificationContainer');
      const notification = document.createElement('div');
      
      const typeClasses = {
        success: 'bg-green-500/90 text-white border-green-400',
        error: 'bg-red-500/90 text-white border-red-400',
        warning: 'bg-yellow-500/90 text-black border-yellow-400',
        info: 'bg-blue-500/90 text-white border-blue-400'
      };
      
      notification.className = `px-4 py-3 rounded-lg border backdrop-blur-sm shadow-lg transform transition-all duration-300 translate-x-full ${typeClasses[type]}`;
      notification.innerHTML = `
        <div class="flex items-center gap-2">
          <div class="flex-1">${message}</div>
          <button onclick="this.parentElement.parentElement.remove()" class="text-white/70 hover:text-white">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      `;
      
      container.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.classList.remove('translate-x-full');
      }, 100);
      
      // Auto remove
      setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
          if (notification.parentElement) {
            notification.remove();
          }
        }, 300);
      }, duration);
    }

    // Make notification globally available
    window.showNotification = showNotification;

    loadData();
  </script>
</script>
  <script defer src="/_vercel/insights/script.js"></script>
  <script defer src="/_vercel/speed-insights/script.js"></script>
</body>
</html>
