<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit Airdrop — Airdrop Hub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { bg: '#0b0f1a' } } }
    }
  </script>
  <style>
    :root { color-scheme: dark; }
    html, body { background: #0b0f1a; color: #fff; }
    .btn { padding: 0.5rem 0.9rem; border-radius: 0.5rem; border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.06); }
    .btn:hover { border-color: rgba(255,255,255,0.25); }
    .help { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
    .error { color: #fca5a5; font-size: 0.8rem; }
  </style>
</head>
<body class="min-h-screen">
  <main class="max-w-2xl mx-auto px-4 py-8">
    <h1 class="text-2xl font-semibold mb-6">Submit Airdrop</h1>

    <form id="submitForm" class="space-y-4" novalidate>
      <div>
        <label class="block text-sm mb-1">Project ID <span class="text-white/50">(lowercase, unique)</span></label>
        <input name="id" class="w-full btn" placeholder="e.g., aster-dex" required />
        <p class="help">Lowercase letters, numbers, and hyphens only.</p>
      </div>

      <div class="grid sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm mb-1">Name</label>
          <input name="name" class="w-full btn" required />
        </div>
        <div>
          <label class="block text-sm mb-1">Chain</label>
          <select name="chain" class="w-full btn" required>
            <option value="">Select</option>
            <option>Ethereum</option>
            <option>Solana</option>
            <option>Arbitrum</option>
            <option>Base</option>
            <option>Polygon</option>
            <option>Aptos</option>
            <option>BNB</option>
          </select>
        </div>
      </div>

      <div class="grid sm:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm mb-1">Reward (USD)</label>
          <input name="rewardUSD" type="number" min="0" step="1" class="w-full btn" placeholder="e.g., 250" required />
        </div>
        <div>
          <label class="block text-sm mb-1">Status</label>
          <select name="status" class="w-full btn" required>
            <option value="">Select</option>
            <option>live</option>
            <option>upcoming</option>
            <option>ended</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-1 flex items-center justify-between">
            <span>Deadline</span>
            <span class="help">YYYY-MM-DD</span>
          </label>
          <input name="deadline" class="w-full btn" placeholder="2025-10-05" inputmode="numeric" autocomplete="off" required />
          <p id="deadlineError" class="error hidden">Please enter a valid date in YYYY-MM-DD format.</p>
        </div>
      </div>

      <div>
        <label class="block text-sm mb-1">Tasks (comma‑separated)</label>
        <input name="tasks" class="w-full btn" placeholder="Swap 3x, Provide LP, Bridge" />
      </div>

      <div>
        <label class="block text-sm mb-1">Tags (comma‑separated)</label>
        <input name="tags" class="w-full btn" placeholder="dex, defi, bridge" />
      </div>

      <div class="grid sm:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm mb-1">Site URL</label>
          <input name="site" class="w-full btn" placeholder="https://example.com" />
        </div>
        <div>
          <label class="block text-sm mb-1">Twitter URL</label>
          <input name="twitter" class="w-full btn" placeholder="https://x.com/..." />
        </div>
        <div>
          <label class="block text-sm mb-1">Docs URL</label>
          <input name="docs" class="w-full btn" placeholder="https://docs.example.com" />
        </div>
      </div>

      <div class="flex items-center gap-2">
        <input id="featured" type="checkbox" class="accent-cyan-400" />
        <label for="featured">Mark as Daily Pick</label>
      </div>

      <div class="pt-2">
        <button class="btn" type="submit">Validate & Generate JSON</button>
      </div>

      <div id="resultWrap" class="hidden">
        <h2 class="text-lg font-semibold mt-6 mb-2">Generated JSON</h2>
        <pre id="result" class="whitespace-pre-wrap bg-black/40 p-3 rounded border border-white/10"></pre>
      </div>
    </form>
  </main>

  <script>
    // Robust YYYY-MM-DD validator (no timezone gotchas, strict calendar check)
    function isValidISODate(value) {
      if (typeof value !== 'string') return false;
      const m = value.match(/^(\d{4})-(\d{2})-(\d{2})$/);
      if (!m) return false;
      const y = Number(m[1]), mm = Number(m[2]), dd = Number(m[3]);
      if (mm < 1 || mm > 12) return false;
      if (dd < 1 || dd > 31) return false;
      const dt = new Date(Date.UTC(y, mm - 1, dd));
      // Ensure no auto-correction (e.g., 2025-02-31 --> Mar 3) and same components
      return dt.getUTCFullYear() === y && (dt.getUTCMonth() + 1) === mm && dt.getUTCDate() === dd;
    }

    function splitCSV(s) {
      if (!s) return [];
      return s.split(',').map(x => x.trim()).filter(Boolean);
    }

    const form = document.getElementById('submitForm');
    const deadlineInput = form.elements['deadline'];
    const deadlineError = document.getElementById('deadlineError');

    function showDeadlineError(show) {
      deadlineError.classList.toggle('hidden', !show);
      deadlineInput.classList.toggle('ring-2', show);
      deadlineInput.classList.toggle('ring-red-400/70', show);
    }

    deadlineInput.addEventListener('blur', () => {
      const v = deadlineInput.value.trim();
      showDeadlineError(v.length > 0 && !isValidISODate(v));
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const data = {
        id: form.elements['id'].value.trim(),
        name: form.elements['name'].value.trim(),
        chain: form.elements['chain'].value,
        rewardUSD: Number(form.elements['rewardUSD'].value),
        status: form.elements['status'].value,
        deadline: form.elements['deadline'].value.trim(),
        tasks: splitCSV(form.elements['tasks'].value),
        tags: splitCSV(form.elements['tags'].value),
        popularity: 1,
        featured: document.getElementById('featured').checked,
        links: {
          site: form.elements['site'].value.trim(),
          twitter: form.elements['twitter'].value.trim(),
          docs: form.elements['docs'].value.trim()
        }
      };

      // Field validations
      const idOk = /^[a-z0-9-]+$/.test(data.id);
      const chainOk = !!data.chain;
      const statusOk = ['live', 'upcoming', 'ended'].includes(data.status);
      const rewardOk = Number.isFinite(data.rewardUSD) && data.rewardUSD >= 0;
      const deadlineOk = isValidISODate(data.deadline);

      showDeadlineError(!deadlineOk);

      if (!idOk) return alert('ID must be lowercase letters, numbers, or hyphens only (e.g., aster-dex).');
      if (!chainOk) return alert('Please select a chain.');
      if (!statusOk) return alert('Please select a valid status.');
      if (!rewardOk) return alert('Reward must be a non-negative number.');
      if (!deadlineOk) return alert('Deadline must be a valid date in YYYY-MM-DD (e.g., 2025-10-05).');

      // Output nicely formatted JSON ready for data.json
      const cleanLinks = {};
      for (const k of ['site','twitter','docs']) {
        if (data.links[k]) cleanLinks[k] = data.links[k];
      }
      const output = {
        id: data.id,
        name: data.name,
        chain: data.chain,
        rewardUSD: data.rewardUSD,
        status: data.status,
        deadline: data.deadline,
        tasks: data.tasks,
        tags: data.tags,
        popularity: data.popularity,
        ...(data.featured ? { featured: true } : {}),
        links: cleanLinks
      };

      document.getElementById('result').textContent = JSON.stringify(output, null, 2);
      document.getElementById('resultWrap').classList.remove('hidden');
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    });
  </script>
</body>
</html>