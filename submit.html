<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit Airdrop ‚Äî Airdrop Hub</title>
  <meta name="description" content="Submit a new crypto airdrop to Airdrop Hub. Share your project with the community and help others discover new opportunities." />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          colors: { 
            bg: '#0a0e1a', 
            card: '#111827', 
            edge: '#1f2937', 
            accent: '#3b82f6',
            accentHover: '#2563eb',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444'
          },
          boxShadow: { 
            glow: '0 0 20px rgba(59, 130, 246, 0.15), 0 0 40px rgba(59, 130, 246, 0.1)',
            card: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
          }
        }
      }
    }
  </script>
  <style>
    :root { 
      color-scheme: dark; 
      --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    }
    
    html, body { 
      background: linear-gradient(135deg, #0a0e1a 0%, #111827 100%);
      min-height: 100vh;
    }
    
    .btn { 
      padding: 0.5rem 1rem; 
      border-radius: 0.75rem; 
      border: 1px solid rgba(255,255,255,0.1); 
      background: rgba(255,255,255,0.05); 
      transition: all 0.2s ease;
      font-weight: 500;
    }
    .btn:hover { 
      border-color: rgba(59, 130, 246, 0.5); 
      background: rgba(59, 130, 246, 0.1);
      transform: translateY(-1px);
    }
    .btn-primary {
      background: var(--gradient-primary);
      border-color: #3b82f6;
      color: white;
    }
    .btn-primary:hover {
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
      transform: translateY(-1px);
    }
    
    .form-input {
      background: rgba(17, 24, 39, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.2s ease;
    }
    
    .form-input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .card {
      background: rgba(17, 24, 39, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .help { font-size: 0.75rem; color: rgba(255,255,255,0.6); }
    .error { color: #fca5a5; font-size: 0.8rem; }
    .ok { color: #86efac; font-size: 0.8rem; }
    .gridish { display: grid; gap: 1rem; grid-template-columns: 1fr; }
    @media (min-width: 900px) { .gridish { grid-template-columns: 1fr 1fr; } }
    .preview { border: 1px solid rgba(255,255,255,0.1); background: rgba(17, 24, 39, 0.8); border-radius: 0.75rem; padding: 1rem; backdrop-filter: blur(10px); }
  </style>
</head>
<body class="min-h-screen text-white">
  <header class="sticky top-0 z-40 bg-black/20 backdrop-blur-md border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <a href="index.html" class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-lg">
          <span class="text-white font-bold text-lg">ü™Ç</span>
        </a>
        <div>
          <h1 class="text-xl sm:text-2xl font-bold text-white">Submit Airdrop</h1>
          <p class="text-xs text-white/60 hidden sm:block">Share your project with the community</p>
        </div>
      </div>
      <nav class="flex items-center gap-2 sm:gap-4 text-sm">
        <a href="index.html" class="text-white/70 hover:text-white transition-colors px-3 py-2 rounded-lg hover:bg-white/5">‚Üê Back to Hub</a>
      </nav>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="text-center mb-12">
      <h2 class="text-4xl sm:text-5xl font-bold text-white mb-4 bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent">
        Submit Your Airdrop
      </h2>
      <p class="text-lg text-white/70 max-w-2xl mx-auto">
        Share your crypto airdrop with the community. Fill out the form below to get your project listed on Airdrop Hub.
      </p>
    </div>

    <div class="gridish">
      <!-- Form -->
      <form id="submitForm" class="space-y-6" novalidate>
        <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
          <h3 class="text-lg font-semibold text-white mb-4">Basic Information</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-white/80 mb-2">Project ID <span class="text-white/50">(lowercase, unique)</span></label>
              <input name="id" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="e.g., aster-dex" required />
              <p class="help mt-1">Lowercase letters, numbers, and hyphens only.</p>
              <p id="idStatus" class="help"></p>
            </div>

            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Project Name</label>
                <input name="name" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="e.g., ASTER DEX" required />
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Blockchain</label>
                <select name="chain" class="w-full form-input rounded-lg px-3 py-2 text-white" required>
                  <option value="">Select Chain</option>
                  <option>Ethereum</option>
                  <option>Solana</option>
                  <option>Arbitrum</option>
                  <option>Base</option>
                  <option>Polygon</option>
                  <option>Aptos</option>
                  <option>BNB</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
          <h3 class="text-lg font-semibold text-white mb-4">Airdrop Details</h3>
          <div class="space-y-4">
            <div class="grid sm:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Reward (USD)</label>
                <input name="rewardUSD" type="number" min="0" step="1" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="e.g., 250" required />
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Status</label>
                <select name="status" class="w-full form-input rounded-lg px-3 py-2 text-white" required>
                  <option value="">Select Status</option>
                  <option>live</option>
                  <option>upcoming</option>
                  <option>ended</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2 flex items-center justify-between">
                  <span>Deadline</span>
                  <span class="help">YYYY-MM-DD</span>
                </label>
                <input name="deadline" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="2025-10-05" inputmode="numeric" autocomplete="off" required />
                <p id="deadlineError" class="error hidden">Please enter a valid date in YYYY-MM-DD format.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
          <h3 class="text-lg font-semibold text-white mb-4">Advanced Metrics (Optional)</h3>
          <div class="space-y-4">
            <div class="grid sm:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Est. Token Value (USD)</label>
                <input name="baseEstTokenValue" type="number" min="0" step="1" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="e.g., 500" />
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">P(Token)</label>
                <input name="pToken" type="number" min="0" max="1" step="0.05" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="0.5" />
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">P(Eligibility)</label>
                <input name="pEligibility" type="number" min="0" max="1" step="0.05" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="0.6" />
              </div>
            </div>

            <div class="grid sm:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Est. Hours</label>
                <input name="estHours" type="number" min="0" step="0.25" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="2" />
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Est. Gas (USD)</label>
                <input name="estGasUSD" type="number" min="0" step="0.5" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="5" />
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Snapshot Probability (%)</label>
                <input name="snapshotProb" type="number" min="0" max="100" step="5" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="60" />
              </div>
            </div>

            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Snapshot Window (days)</label>
                <input name="snapshotWindowDays" type="number" min="0" step="1" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="30" />
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Added Date</label>
                <input name="addedDate" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="YYYY-MM-DD" />
              </div>
            </div>
          </div>
        </div>

        <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
          <h3 class="text-lg font-semibold text-white mb-4">Content & Information</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-white/80 mb-2">Tasks (comma‚Äëseparated)</label>
              <input name="tasks" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="Swap 3x, Provide LP, Bridge" />
              <p class="help mt-1">List the main tasks users need to complete for the airdrop.</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-white/80 mb-2">Tags (comma‚Äëseparated)</label>
              <input name="tags" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="dex, defi, bridge" />
              <p class="help mt-1">Add relevant tags to help users find your airdrop.</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-white/80 mb-2">Risks (comma‚Äëseparated)</label>
              <input name="risk" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="No audit, New contract < 30d" />
              <p class="help mt-1">List any potential risks or warnings for users.</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-white/80 mb-2">Coach Steps (comma‚Äëseparated)</label>
              <input name="coachSteps" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="Bridge from chain A, Do 3 txs on base, Provide LP for 7d" />
              <p class="help mt-1">Detailed step-by-step instructions for users.</p>
            </div>
          </div>
        </div>

        <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
          <h3 class="text-lg font-semibold text-white mb-4">Links & Resources</h3>
          <div class="space-y-4">
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Website URL</label>
                <input name="site" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="https://example.com" />
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Twitter URL</label>
                <input name="twitter" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="https://x.com/..." />
              </div>
            </div>
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Documentation URL</label>
                <input name="docs" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="https://docs.example.com" />
              </div>
              <div>
                <label class="block text-sm font-medium text-white/80 mb-2">Tutorial URL</label>
                <input name="tutorial" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="https://example.com/tutorial" />
                <p class="help mt-1">Optional. Appears as a "Tutorial" button on the card.</p>
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-white/80 mb-2">Hot on X Topic ID</label>
              <input name="topicId" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="e.g., layerzeroszn" />
              <p class="help mt-1">Optional. For trending topics on X (Twitter).</p>
            </div>
          </div>
        </div>

        <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
          <h3 class="text-lg font-semibold text-white mb-4">Featured Options</h3>
          <div class="space-y-4">
            <div class="flex items-center gap-3">
              <input id="featured" type="checkbox" class="accent-blue-500 w-4 h-4" />
              <label for="featured" class="text-white/80 font-medium">Mark as Daily Pick</label>
            </div>
            <div>
              <label class="block text-sm font-medium text-white/80 mb-2">Featured Order <span class="text-white/50">(1-3)</span></label>
              <input name="featuredOrder" type="number" min="1" max="3" step="1" class="w-full form-input rounded-lg px-3 py-2 text-white" placeholder="1" />
              <p class="help mt-1">Lower number appears earlier in Daily Picks. Optional.</p>
            </div>
          </div>
        </div>

        <div class="flex gap-4 pt-4">
          <button class="btn-primary px-6 py-3 text-lg font-semibold" type="submit">
            <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Validate & Generate JSON
          </button>
          <button id="copyBtn" type="button" class="btn px-6 py-3 text-lg">
            <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
            Copy JSON
          </button>
        </div>

        <div id="resultWrap" class="hidden">
          <h2 class="text-lg font-semibold mt-6 mb-2">Generated JSON</h2>
          <pre id="result" class="whitespace-pre-wrap bg-black/40 p-3 rounded border border-white/10"></pre>
        </div>
      </form>

      <!-- Live Preview -->
      <aside class="preview">
        <h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          </svg>
          Live Preview
        </h3>
        <div id="previewCard" class="text-white/80 text-sm">
          <div class="text-center py-8 text-white/60">
            <svg class="w-12 h-12 mx-auto mb-3 text-white/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <p>Fill out the form to see a live preview of your airdrop card</p>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script>
    function isValidISODate(value) {
      if (typeof value !== 'string') return false;
      const m = value.match(/^(\d{4})-(\d{2})-(\d{2})$/);
      if (!m) return false;
      const y = Number(m[1]), mm = Number(m[2]), dd = Number(m[3]);
      const dt = new Date(Date.UTC(y, mm - 1, dd));
      return dt.getUTCFullYear() === y && (dt.getUTCMonth() + 1) === mm && dt.getUTCDate() === dd;
    }
    function splitCSV(s) { return !s ? [] : s.split(',').map(x => x.trim()).filter(Boolean); }
    function normUrl(u) { if (!u) return ''; const v=u.trim(); if (/^https?:\/\//i.test(v)) return v; return 'https://' + v; }
    function esc(s){ return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    const form = document.getElementById('submitForm');
    const deadlineInput = form.elements['deadline'];
    const deadlineError = document.getElementById('deadlineError');
    const idInput = form.elements['id'];
    const idStatus = document.getElementById('idStatus');
    const previewCard = document.getElementById('previewCard');
    const copyBtn = document.getElementById('copyBtn');
    let EXISTING_IDS = new Set();

    async function loadExistingIds() {
      try { const res = await fetch('data/data.json', { cache: 'no-store' }); const arr = await res.json(); EXISTING_IDS = new Set(arr.map(x => x.id)); updateIdStatus(); } catch {}
    }
    function updateIdStatus() {
      const id = idInput.value.trim();
      const ok = /^[a-z0-9-]+$/.test(id);
      if (!id) { idStatus.textContent = ''; return; }
      if (!ok) { idStatus.textContent = 'Invalid: use lowercase letters, numbers, and hyphens only.'; idStatus.className = 'error'; return; }
      if (EXISTING_IDS.has(id)) { idStatus.textContent = 'This ID already exists in data.json'; idStatus.className = 'error'; }
      else { idStatus.textContent = 'ID is available'; idStatus.className = 'ok'; }
    }
    idInput.addEventListener('input', updateIdStatus);
    deadlineInput.addEventListener('blur', () => {
      const v = deadlineInput.value.trim();
      deadlineError.classList.toggle('hidden', !(v.length > 0 && !isValidISODate(v)));
    });

    function collectData(normalize = true) {
      const links = {
        site: form.elements['site'].value.trim(),
        twitter: form.elements['twitter'].value.trim(),
        docs: form.elements['docs'].value.trim(),
        tutorial: form.elements['tutorial'].value.trim()
      };
      if (normalize) for (const k in links) links[k] = normUrl(links[k]);

      return {
        id: form.elements['id'].value.trim(),
        name: form.elements['name'].value.trim(),
        chain: form.elements['chain'].value,
        rewardUSD: Number(form.elements['rewardUSD'].value),
        status: form.elements['status'].value,
        deadline: form.elements['deadline'].value.trim(),
        baseEstTokenValue: Number(form.elements['baseEstTokenValue'].value),
        pToken: Number(form.elements['pToken'].value),
        pEligibility: Number(form.elements['pEligibility'].value),
        estHours: Number(form.elements['estHours'].value),
        estGasUSD: Number(form.elements['estGasUSD'].value),
        snapshotProb: form.elements['snapshotProb'].value ? Number(form.elements['snapshotProb'].value) : undefined,
        snapshotWindowDays: form.elements['snapshotWindowDays'].value ? Number(form.elements['snapshotWindowDays'].value) : undefined,
        addedDate: form.elements['addedDate'].value.trim(),
        tasks: splitCSV(form.elements['tasks'].value),
        tags: splitCSV(form.elements['tags'].value),
        risk: splitCSV(form.elements['risk'].value),
        coachSteps: splitCSV(form.elements['coachSteps'].value),
        popularity: 1,
        featured: document.getElementById('featured').checked,
        featuredOrder: form.elements['featuredOrder'].value ? Number(form.elements['featuredOrder'].value) : undefined,
        topicId: form.elements['topicId'].value.trim(),
        links
      };
    }

    function validateData(d) {
      const errs = [];
      if (!/^[a-z0-9-]+$/.test(d.id)) errs.push('ID must be lowercase letters, numbers, or hyphens only (e.g., aster-dex).');
      if (EXISTING_IDS.has(d.id)) errs.push('This ID already exists in data/data.json. Please choose another.');
      if (!d.chain) errs.push('Please select a chain.');
      if (!['live','upcoming','ended'].includes(d.status)) errs.push('Please select a valid status.');
      if (!Number.isFinite(d.rewardUSD) || d.rewardUSD < 0) errs.push('Reward must be a non-negative number.');
      if (!isValidISODate(d.deadline)) errs.push('Deadline must be a valid date in YYYY-MM-DD (e.g., 2025-10-05).');
      if (d.addedDate && !isValidISODate(d.addedDate)) errs.push('Added Date must be YYYY-MM-DD.');
      for (const k of ['site','twitter','docs','tutorial']) { const v = d.links[k]; if (v && !/^https?:\/\//i.test(v)) errs.push(`${k} must start with http(s)://`); }
      if (d.featured && d.featuredOrder !== undefined) {
        if (!(Number.isInteger(d.featuredOrder) && d.featuredOrder>=1 && d.featuredOrder<=3)) errs.push('Featured Order must be 1..3.');
      }
      return errs;
    }

    function computeEV(d) {
      const baseVal = Number(d.baseEstTokenValue || 0);
      const pToken = Number(d.pToken || 0);
      const pElig = Number(d.pEligibility || 0);
      const gas = Number(d.estGasUSD || 0);
      const ev = (pToken * pElig * baseVal) - gas;
      const hours = Math.max(0.25, Number(d.estHours || 0.5));
      const evhr = ev / hours;
      return { ev, evhr };
    }

    // Live preview
    form.addEventListener('input', () => {
      const d = collectData(false);
      const { ev, evhr } = computeEV(d);
      previewCard.innerHTML = `
        <div class="text-base font-semibold">${esc(d.name || 'Project Name')}</div>
        <div class="text-xs text-white/60">${esc(d.chain || 'Chain')} ‚Ä¢ ${esc(d.status || 'status')}</div>
        <div class="mt-2 grid grid-cols-3 gap-2 text-sm">
          <div class="bg-white/5 rounded p-2"><div class="text-white/60 text-xs">Reward</div><div class="font-medium">$${Number(d.rewardUSD || 0)}</div></div>
          <div class="bg-white/5 rounded p-2"><div class="text-white/60 text-xs">EV</div><div class="font-medium">$${ev.toFixed(0)} <span class="text-white/50 text-xs">(hr: $${evhr.toFixed(0)})</span></div></div>
          <div class="bg-white/5 rounded p-2"><div class="text-white/60 text-xs">Deadline</div><div class="font-medium">${esc(d.deadline || 'YYYY-MM-DD')}</div></div>
        </div>
        <ul class="mt-3 text-sm list-disc ml-5 text-white/80">${d.tasks.slice(0,3).map(t=>`<li>${esc(t)}</li>`).join('')}</ul>
        <div class="mt-3 flex flex-wrap gap-2">${d.tags.map(tag => `<span class="inline-block text-xs px-2 py-1 rounded border border-white/10 bg-white/5">${esc(tag)}</span>`).join('')}</div>
      `;
    });

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const data = collectData(true);
      const errs = validateData(data);
      if (errs.length) return alert(errs[0]);

      const cleanLinks = {};
      for (const k of ['site','twitter','docs','tutorial']) if (data.links[k]) cleanLinks[k] = data.links[k];

      const output = {
        id: data.id,
        name: data.name,
        chain: data.chain,
        rewardUSD: data.rewardUSD,
        status: data.status,
        deadline: data.deadline,
        tasks: data.tasks,
        tags: data.tags,
        popularity: data.popularity,
        ...(data.baseEstTokenValue ? { baseEstTokenValue: data.baseEstTokenValue } : {}),
        ...(isFinite(data.pToken) ? { pToken: data.pToken } : {}),
        ...(isFinite(data.pEligibility) ? { pEligibility: data.pEligibility } : {}),
        ...(isFinite(data.estHours) ? { estHours: data.estHours } : {}),
        ...(isFinite(data.estGasUSD) ? { estGasUSD: data.estGasUSD } : {}),
        ...(isFinite(data.snapshotProb) ? { snapshotProb: data.snapshotProb } : {}),
        ...(isFinite(data.snapshotWindowDays) ? { snapshotWindowDays: data.snapshotWindowDays } : {}),
        ...(data.addedDate ? { addedDate: data.addedDate } : {}),
        ...(data.risk && data.risk.length ? { risk: data.risk } : {}),
        ...(data.coachSteps && data.coachSteps.length ? { coachSteps: data.coachSteps } : {}),
        ...(data.topicId ? { topicId: data.topicId } : {}),
        ...(data.featured ? { featured: true } : {}),
        ...(data.featured && data.featuredOrder ? { featuredOrder: data.featuredOrder } : {}),
        links: cleanLinks
      };

      document.getElementById('result').textContent = JSON.stringify(output, null, 2);
      document.getElementById('resultWrap').classList.remove('hidden');
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    });

    copyBtn.addEventListener('click', async () => {
      const txt = document.getElementById('result').textContent.trim();
      if (!txt) return alert('Generate JSON first.');
      try { await navigator.clipboard.writeText(txt); alert('Copied JSON.'); } catch { alert('Copy failed.'); }
    });

    loadExistingIds();
  </script>
</body>
</html>
