<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet Analysis - Airdrop Hub</title>
  <meta name="description" content="Deep wallet analysis across 15+ blockchain networks for airdrop eligibility and trading insights">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eff6ff',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
            }
          }
        }
      }
    }
  </script>
  <style>
    .form-input {
      @apply bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent;
    }
    .btn-primary {
      @apply bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl;
    }
    .loading-spinner {
      @apply border-4 border-white/20 border-t-blue-500 rounded-full animate-spin;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 min-h-screen">
  <header class="bg-black/20 backdrop-blur-sm border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center space-x-4">
          <a href="index.html" class="text-2xl font-bold text-white">ðŸš€ Airdrop Hub</a>
          <nav class="hidden md:flex space-x-6">
            <a href="index.html" class="text-white/60 hover:text-white">Home</a>
            <a href="submit.html" class="text-white/60 hover:text-white">Submit</a>
            <a href="wallet-analysis.html" class="text-white">Wallet Analysis</a>
          </nav>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="text-center mb-12">
      <h1 class="text-4xl sm:text-6xl font-bold text-white mb-4 bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent">
        Deep Wallet Analysis
      </h1>
      <p class="text-lg text-white/70 max-w-2xl mx-auto">
        Select a blockchain and analyze your wallet with deep insights, transaction volume tiers, and airdrop eligibility scoring.
      </p>
    </div>

    <!-- Chain Selector & Address Input -->
    <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-8 border border-white/10 mb-8">
      <div class="max-w-4xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4">
          <!-- Chain Selector -->
          <div>
            <label class="block text-sm font-medium text-white/80 mb-2">Select Blockchain</label>
            <select id="chainSelector" class="w-full form-input rounded-lg px-4 py-3 text-white">
              <option value="">Choose a blockchain...</option>
            </select>
          </div>
          
          <!-- Address Input -->
          <div>
            <label class="block text-sm font-medium text-white/80 mb-2">Wallet Address</label>
            <input id="walletInput" type="text" placeholder="Enter wallet address..." class="w-full form-input rounded-lg px-4 py-3 text-white" disabled />
          </div>
          
          <!-- Analyze Button -->
          <div class="flex items-end">
            <button id="analyzeBtn" class="w-full btn-primary px-8 py-3 text-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
              </svg>
              Deep Analysis
            </button>
          </div>
        </div>
        
        <!-- Chain Info -->
        <div id="chainInfo" class="p-4 bg-blue-500/10 border border-blue-500/20 rounded-lg hidden">
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-blue-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <div class="font-semibold text-blue-400 mb-1" id="chainInfoTitle">Chain Information</div>
              <div class="text-sm text-white/80" id="chainInfoText">
                Select a blockchain to see detailed analysis capabilities and address format requirements.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="hidden text-center py-12">
      <div class="loading-spinner w-12 h-12 mx-auto mb-4"></div>
      <p class="text-white/70">Analyzing wallet data...</p>
      <p class="text-sm text-white/50 mt-2">This may take a few moments</p>
    </div>

    <!-- Results Section -->
    <div id="resultsSection" class="hidden">
      <!-- Selected Chain Header -->
      <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 backdrop-blur-sm rounded-2xl p-6 border border-white/10 mb-6">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-white mb-2" id="selectedChainName">Chain Analysis</h2>
            <p class="text-white/70" id="selectedChainAddress">Wallet Address: <span id="displayAddress"></span></p>
          </div>
          <div class="text-right">
            <div class="text-sm text-white/60">Deep Analysis</div>
            <div class="text-lg font-semibold text-white" id="analysisTimestamp"></div>
          </div>
        </div>
      </div>

      <!-- Wallet Overview -->
      <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10 mb-6">
        <h3 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          Wallet Overview
        </h3>
        <div id="walletOverview" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>

      <!-- Transaction Volume Tiers -->
      <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10 mb-6">
        <h3 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
          </svg>
          Transaction Volume Ranking
        </h3>
        <div id="volumeTiers" class="space-y-4">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>

      <!-- Activity Analysis -->
      <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10 mb-6">
        <h3 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          Deep Activity Analysis
        </h3>
        <div id="activityAnalysis" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>

      <!-- Airdrop Eligibility -->
      <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10 mb-6">
        <h3 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
          </svg>
          Airdrop Eligibility Score
        </h3>
        <div id="airdropEligibility" class="space-y-4">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>

      <!-- Recent Transactions -->
      <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/10">
        <h3 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
          <svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
          </svg>
          Recent Transactions
        </h3>
        <div id="transactionHistory" class="space-y-3">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- Error State -->
    <div id="errorState" class="hidden text-center py-12">
      <div class="bg-red-500/10 border border-red-500/20 rounded-lg p-6 max-w-md mx-auto">
        <svg class="w-12 h-12 text-red-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h3 class="text-lg font-semibold text-white mb-2">Analysis Failed</h3>
        <p class="text-white/70" id="errorMessage">Something went wrong</p>
      </div>
    </div>
  </main>

  <script>
    // Chain configurations with deep analysis capabilities
    const CHAINS = {
      ethereum: {
        name: 'Ethereum',
        rpc: 'https://eth.llamarpc.com',
        explorer: 'https://etherscan.io',
        color: 'bg-blue-500',
        textColor: 'text-blue-400',
        etherscanApi: true,
        volumeTiers: [0.1, 1, 5, 10, 25, 50, 100] // ETH volume tiers
      },
      base: {
        name: 'Base',
        rpc: 'https://mainnet.base.org',
        explorer: 'https://basescan.org',
        color: 'bg-blue-600',
        textColor: 'text-blue-300',
        etherscanApi: true,
        volumeTiers: [0.1, 1, 5, 10, 25, 50, 100]
      },
      arbitrum: {
        name: 'Arbitrum',
        rpc: 'https://arb1.arbitrum.io/rpc',
        explorer: 'https://arbiscan.io',
        color: 'bg-cyan-500',
        textColor: 'text-cyan-400',
        etherscanApi: true,
        volumeTiers: [0.1, 1, 5, 10, 25, 50, 100]
      },
      polygon: {
        name: 'Polygon',
        rpc: 'https://polygon-rpc.com',
        explorer: 'https://polygonscan.com',
        color: 'bg-purple-500',
        textColor: 'text-purple-400',
        etherscanApi: true,
        volumeTiers: [1, 10, 50, 100, 250, 500, 1000] // MATIC volume tiers
      },
      avalanche: {
        name: 'Avalanche',
        rpc: 'https://api.avax.network/ext/bc/C/rpc',
        explorer: 'https://snowtrace.io',
        color: 'bg-red-600',
        textColor: 'text-red-300',
        etherscanApi: true,
        volumeTiers: [1, 10, 50, 100, 250, 500, 1000] // AVAX volume tiers
      },
      bsc: {
        name: 'BNB Chain',
        rpc: 'https://bsc-dataseed.binance.org',
        explorer: 'https://bscscan.com',
        color: 'bg-yellow-500',
        textColor: 'text-yellow-400',
        etherscanApi: true,
        volumeTiers: [0.5, 5, 25, 50, 100, 250, 500] // BNB volume tiers
      }
    };

    // API Configuration
    const API_CONFIG = {
      etherscan: {
        ethereum: 'https://api.etherscan.io/api',
        polygon: 'https://api.polygonscan.com/api',
        arbitrum: 'https://api.arbiscan.io/api',
        base: 'https://api.basescan.org/api',
        avalanche: 'https://api.snowtrace.io/api',
        bsc: 'https://api.bscscan.com/api',
        apiKey: 'SNB4UGKDJMP6XPZIGIBYM55IN8K3NP8AM3'
      },
      public: {
        ethereum: 'https://eth.llamarpc.com',
        polygon: 'https://polygon-rpc.com',
        arbitrum: 'https://arb1.arbitrum.io/rpc',
        base: 'https://mainnet.base.org',
        avalanche: 'https://api.avax.network/ext/bc/C/rpc',
        bsc: 'https://bsc-dataseed.binance.org'
      }
    };

    // Address validation for different chains
    function isValidAddress(address, chain) {
      if (!address || !chain) return false;
      // All our supported chains use EVM format
      return /^0x[a-fA-F0-9]{40}$/.test(address);
    }

    function formatAddress(address) {
      return `${address.slice(0, 6)}...${address.slice(-4)}`;
    }

    function formatNumber(num) {
      return new Intl.NumberFormat().format(num);
    }

    function formatUSD(amount) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
      }).format(amount);
    }

    // Initialize chain selector
    function initializeChainSelector() {
      const selector = document.getElementById('chainSelector');
      Object.entries(CHAINS).forEach(([key, chain]) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = chain.name;
        selector.appendChild(option);
      });
    }

    // Show/hide chain info
    function updateChainInfo(chainKey) {
      const chainInfo = document.getElementById('chainInfo');
      const chainInfoTitle = document.getElementById('chainInfoTitle');
      const chainInfoText = document.getElementById('chainInfoText');
      const walletInput = document.getElementById('walletInput');
      const analyzeBtn = document.getElementById('analyzeBtn');

      if (chainKey && CHAINS[chainKey]) {
        const chain = CHAINS[chainKey];
        chainInfoTitle.textContent = `${chain.name} Analysis`;
        chainInfoText.textContent = `Analyze wallet activity on ${chain.name}. Address format: 0x... (EVM compatible). Volume tiers: ${chain.volumeTiers.join(', ')} ETH/chain tokens.`;
        
        walletInput.placeholder = `Enter ${chain.name} wallet address (0x...)`;
        walletInput.disabled = false;
        chainInfo.classList.remove('hidden');
      } else {
        walletInput.disabled = true;
        analyzeBtn.disabled = true;
        chainInfo.classList.add('hidden');
      }
    }

    // Calculate volume tiers
    function calculateVolumeTiers(volume, chainKey) {
      const chain = CHAINS[chainKey];
      const tiers = chain.volumeTiers;
      
      let currentTier = 'Novice';
      let tierColor = 'text-red-400';
      let tierIcon = 'ðŸŸ¢';
      
      if (volume >= tiers[6]) {
        currentTier = 'Whale';
        tierColor = 'text-purple-400';
        tierIcon = 'ðŸ‹';
      } else if (volume >= tiers[5]) {
        currentTier = 'Diamond Hands';
        tierColor = 'text-blue-400';
        tierIcon = 'ðŸ’Ž';
      } else if (volume >= tiers[4]) {
        currentTier = 'High Roller';
        tierColor = 'text-green-400';
        tierIcon = 'ðŸŽ°';
      } else if (volume >= tiers[3]) {
        currentTier = 'Active Trader';
        tierColor = 'text-yellow-400';
        tierIcon = 'âš¡';
      } else if (volume >= tiers[2]) {
        currentTier = 'Regular User';
        tierColor = 'text-orange-400';
        tierIcon = 'ðŸ“ˆ';
      } else if (volume >= tiers[1]) {
        currentTier = 'Casual User';
        tierColor = 'text-cyan-400';
        tierIcon = 'ðŸ”„';
      }

      return {
        tier: currentTier,
        color: tierColor,
        icon: tierIcon,
        volume: volume,
        nextTier: tiers.find(tier => tier > volume) || 'Max Tier'
      };
    }

    // Calculate activity metrics
    function calculateActivityMetrics(transactions, tokenTransfers, nftTransfers) {
      const uniqueContracts = new Set();
      const uniqueTokens = new Set();
      const uniqueNfts = new Set();
      
      transactions.forEach(tx => {
        if (tx.to) uniqueContracts.add(tx.to);
      });
      
      tokenTransfers.forEach(tx => {
        if (tx.contractAddress) uniqueTokens.add(tx.contractAddress);
      });
      
      nftTransfers.forEach(tx => {
        if (tx.contractAddress) uniqueNfts.add(tx.contractAddress);
      });

      return {
        uniqueContracts: uniqueContracts.size,
        uniqueTokens: uniqueTokens.size,
        uniqueNfts: uniqueNfts.size,
        totalInteractions: transactions.length + tokenTransfers.length + nftTransfers.length
      };
    }

    // Calculate airdrop score
    function calculateAirdropScore(metrics) {
      let score = 0;
      
      // Transaction count (max 30 points)
      score += Math.min(30, metrics.txCount * 2);
      
      // Volume (max 25 points)
      score += Math.min(25, metrics.volume * 2);
      
      // Unique contracts (max 20 points)
      score += Math.min(20, metrics.uniqueContracts * 2);
      
      // Token interactions (max 15 points)
      score += Math.min(15, metrics.tokenCount * 1.5);
      
      // NFT interactions (max 10 points)
      score += Math.min(10, metrics.nftCount * 2);
      
      return Math.min(100, Math.round(score));
    }

    // API Functions
    async function getNativeBalance(address, chain) {
      try {
        const rpcUrl = API_CONFIG.public[chain];
        if (!rpcUrl) throw new Error(`No RPC for chain: ${chain}`);

        const response = await fetch(rpcUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            jsonrpc: '2.0',
            method: 'eth_getBalance',
            params: [address, 'latest'],
            id: 1
          })
        });

        const data = await response.json();
        if (data.error) throw new Error(data.error.message);
        
        return parseInt(data.result, 16) / Math.pow(10, 18);
      } catch (error) {
        console.warn(`Failed to get balance for ${chain}:`, error);
        return 0;
      }
    }

    async function getTransactionHistory(address, chain) {
      try {
        const chainConfig = CHAINS[chain];
        if (!chainConfig || !chainConfig.etherscanApi) {
          throw new Error(`No Etherscan API for chain: ${chain}`);
        }

        const etherscanUrl = API_CONFIG.etherscan[chain];
        if (!etherscanUrl) {
          throw new Error(`No Etherscan API for chain: ${chain}`);
        }

        const response = await fetch(`${etherscanUrl}?module=account&action=txlist&address=${address}&startblock=0&endblock=99999999&page=1&offset=100&sort=desc&apikey=${API_CONFIG.etherscan.apiKey}`);
        const data = await response.json();
        
        if (data.status !== '1') {
          throw new Error(data.message || 'API Error');
        }
        
        return data.result || [];
      } catch (error) {
        console.warn(`Failed to fetch transactions for ${chain}:`, error);
        return [];
      }
    }

    async function getTokenTransfers(address, chain) {
      try {
        const chainConfig = CHAINS[chain];
        if (!chainConfig || !chainConfig.etherscanApi) {
          throw new Error(`No Etherscan API for chain: ${chain}`);
        }

        const etherscanUrl = API_CONFIG.etherscan[chain];
        if (!etherscanUrl) {
          throw new Error(`No Etherscan API for chain: ${chain}`);
        }

        const response = await fetch(`${etherscanUrl}?module=account&action=tokentx&address=${address}&startblock=0&endblock=99999999&page=1&offset=50&sort=desc&apikey=${API_CONFIG.etherscan.apiKey}`);
        const data = await response.json();
        
        if (data.status !== '1') {
          throw new Error(data.message || 'API Error');
        }
        
        return data.result || [];
      } catch (error) {
        console.warn(`Failed to fetch token transfers for ${chain}:`, error);
        return [];
      }
    }

    async function getERC721Transfers(address, chain) {
      try {
        const chainConfig = CHAINS[chain];
        if (!chainConfig || !chainConfig.etherscanApi) {
          throw new Error(`No Etherscan API for chain: ${chain}`);
        }

        const etherscanUrl = API_CONFIG.etherscan[chain];
        if (!etherscanUrl) {
          throw new Error(`No Etherscan API for chain: ${chain}`);
        }

        const response = await fetch(`${etherscanUrl}?module=account&action=tokennfttx&address=${address}&startblock=0&endblock=99999999&page=1&offset=50&sort=desc&apikey=${API_CONFIG.etherscan.apiKey}`);
        const data = await response.json();
        
        if (data.status !== '1') {
          throw new Error(data.message || 'API Error');
        }
        
        return data.result || [];
      } catch (error) {
        console.warn(`Failed to fetch NFT transfers for ${chain}:`, error);
        return [];
      }
    }

    // Main analysis function
    async function analyzeWallet(address, selectedChain) {
      if (!isValidAddress(address, selectedChain)) {
        throw new Error(`Invalid wallet address format for ${CHAINS[selectedChain].name}`);
      }

      const loadingState = document.getElementById('loadingState');
      const resultsSection = document.getElementById('resultsSection');
      const errorState = document.getElementById('errorState');

      // Show loading state
      loadingState.classList.remove('hidden');
      resultsSection.classList.add('hidden');
      errorState.classList.add('hidden');

      try {
        const chain = CHAINS[selectedChain];
        
        // Get native balance
        const nativeBalance = await getNativeBalance(address, selectedChain);
        
        // Get transaction history
        const transactions = await getTransactionHistory(address, selectedChain);
        
        // Get token transfers
        const tokenTransfers = await getTokenTransfers(address, selectedChain);
        
        // Get NFT transfers
        const nftTransfers = await getERC721Transfers(address, selectedChain);

        // Calculate deep metrics
        const txCount = transactions.length;
        const volume = transactions.reduce((sum, tx) => {
          const value = parseFloat(tx.value) / Math.pow(10, 18);
          return sum + value;
        }, 0);

        const lastActivity = transactions.length > 0 ? new Date(parseInt(transactions[0].timeStamp) * 1000) : null;

        // Calculate volume tiers
        const volumeTiers = calculateVolumeTiers(volume, selectedChain);
        
        // Calculate activity metrics
        const activityMetrics = calculateActivityMetrics(transactions, tokenTransfers, nftTransfers);
        
        // Calculate airdrop score
        const airdropScore = calculateAirdropScore({
          txCount,
          volume,
          uniqueContracts: activityMetrics.uniqueContracts,
          nftCount: nftTransfers.length,
          tokenCount: tokenTransfers.length,
          chain: selectedChain
        });

        const walletData = {
          address: address,
          chain: selectedChain,
          chainName: chain.name,
          balance: nativeBalance,
          txCount: txCount,
          volume: volume,
          lastActivity: lastActivity,
          uniqueContracts: activityMetrics.uniqueContracts,
          nftCount: nftTransfers.length,
          tokenCount: tokenTransfers.length,
          volumeTiers: volumeTiers,
          activityMetrics: activityMetrics,
          airdropScore: airdropScore,
          transactions: transactions.slice(0, 10),
          tokenTransfers: tokenTransfers.slice(0, 5),
          nftTransfers: nftTransfers.slice(0, 5)
        };

        // Render results
        renderChainSpecificResults(walletData);

        // Show results
        loadingState.classList.add('hidden');
        resultsSection.classList.remove('hidden');

      } catch (error) {
        console.error('Analysis failed:', error);
        
        loadingState.classList.add('hidden');
        errorState.classList.remove('hidden');
        
        document.getElementById('errorMessage').textContent = error.message;
      }
    }

    // Render functions
    function renderChainSpecificResults(data) {
      // Update header
      document.getElementById('selectedChainName').textContent = `${data.chainName} Analysis`;
      document.getElementById('displayAddress').textContent = formatAddress(data.address);
      document.getElementById('analysisTimestamp').textContent = new Date().toLocaleString();

      // Render wallet overview
      renderWalletOverview(data);
      
      // Render volume tiers
      renderVolumeTiers(data);
      
      // Render activity analysis
      renderActivityAnalysis(data);
      
      // Render airdrop eligibility
      renderAirdropEligibility(data);
      
      // Render transaction history
      renderTransactionHistory(data);
    }

    function renderWalletOverview(data) {
      const overview = document.getElementById('walletOverview');
      overview.innerHTML = `
        <div class="bg-white/10 rounded-xl p-4 border border-white/20">
          <div class="text-2xl font-bold text-white">${formatNumber(data.balance.toFixed(4))}</div>
          <div class="text-sm text-white/60">${data.chainName} Balance</div>
        </div>
        <div class="bg-white/10 rounded-xl p-4 border border-white/20">
          <div class="text-2xl font-bold text-white">${formatNumber(data.txCount)}</div>
          <div class="text-sm text-white/60">Total Transactions</div>
        </div>
        <div class="bg-white/10 rounded-xl p-4 border border-white/20">
          <div class="text-2xl font-bold text-white">${formatNumber(data.volume.toFixed(2))}</div>
          <div class="text-sm text-white/60">Total Volume</div>
        </div>
        <div class="bg-white/10 rounded-xl p-4 border border-white/20">
          <div class="text-2xl font-bold text-white">${data.uniqueContracts}</div>
          <div class="text-sm text-white/60">Unique Contracts</div>
        </div>
      `;
    }

    function renderVolumeTiers(data) {
      const tiers = document.getElementById('volumeTiers');
      const tier = data.volumeTiers;
      
      tiers.innerHTML = `
        <div class="bg-gradient-to-r from-${tier.color.split('-')[1]}-500/20 to-${tier.color.split('-')[1]}-600/20 rounded-xl p-6 border border-${tier.color.split('-')[1]}-500/30">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <span class="text-3xl">${tier.icon}</span>
              <div>
                <div class="text-2xl font-bold text-white">${tier.tier}</div>
                <div class="text-sm ${tier.color}">Volume Tier</div>
              </div>
            </div>
            <div class="text-right">
              <div class="text-xl font-semibold text-white">${formatNumber(tier.volume.toFixed(2))}</div>
              <div class="text-sm text-white/60">Total Volume</div>
            </div>
          </div>
          <div class="text-sm text-white/70">
            Next tier: ${formatNumber(tier.nextTier)} ${data.chainName === 'Ethereum' ? 'ETH' : 'tokens'}
          </div>
        </div>
      `;
    }

    function renderActivityAnalysis(data) {
      const analysis = document.getElementById('activityAnalysis');
      analysis.innerHTML = `
        <div class="bg-white/10 rounded-xl p-6 border border-white/20">
          <h4 class="text-lg font-semibold text-white mb-4">Contract Interactions</h4>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-white/70">Unique Contracts</span>
              <span class="text-white font-semibold">${data.activityMetrics.uniqueContracts}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-white/70">Token Interactions</span>
              <span class="text-white font-semibold">${data.activityMetrics.uniqueTokens}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-white/70">NFT Collections</span>
              <span class="text-white font-semibold">${data.activityMetrics.uniqueNfts}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-white/70">Total Interactions</span>
              <span class="text-white font-semibold">${formatNumber(data.activityMetrics.totalInteractions)}</span>
            </div>
          </div>
        </div>
        <div class="bg-white/10 rounded-xl p-6 border border-white/20">
          <h4 class="text-lg font-semibold text-white mb-4">Activity Summary</h4>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-white/70">Last Activity</span>
              <span class="text-white font-semibold">${data.lastActivity ? data.lastActivity.toLocaleDateString() : 'No activity'}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-white/70">Transaction Count</span>
              <span class="text-white font-semibold">${formatNumber(data.txCount)}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-white/70">Token Transfers</span>
              <span class="text-white font-semibold">${formatNumber(data.tokenCount)}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-white/70">NFT Transfers</span>
              <span class="text-white font-semibold">${formatNumber(data.nftCount)}</span>
            </div>
          </div>
        </div>
      `;
    }

    function renderAirdropEligibility(data) {
      const eligibility = document.getElementById('airdropEligibility');
      const score = data.airdropScore;
      let scoreColor = 'text-red-400';
      let scoreBg = 'bg-red-500/20';
      let scoreBorder = 'border-red-500/30';
      
      if (score >= 80) {
        scoreColor = 'text-green-400';
        scoreBg = 'bg-green-500/20';
        scoreBorder = 'border-green-500/30';
      } else if (score >= 60) {
        scoreColor = 'text-yellow-400';
        scoreBg = 'bg-yellow-500/20';
        scoreBorder = 'border-yellow-500/30';
      } else if (score >= 40) {
        scoreColor = 'text-orange-400';
        scoreBg = 'bg-orange-500/20';
        scoreBorder = 'border-orange-500/30';
      }

      eligibility.innerHTML = `
        <div class="${scoreBg} ${scoreBorder} border rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <div class="text-3xl font-bold ${scoreColor}">${score}/100</div>
              <div class="text-sm text-white/70">Airdrop Eligibility Score</div>
            </div>
            <div class="text-right">
              <div class="text-lg font-semibold text-white">
                ${score >= 80 ? 'Excellent' : score >= 60 ? 'Good' : score >= 40 ? 'Fair' : 'Low'}
              </div>
              <div class="text-sm text-white/60">Eligibility Level</div>
            </div>
          </div>
          <div class="w-full bg-white/10 rounded-full h-2 mb-4">
            <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-1000" style="width: ${score}%"></div>
          </div>
          <div class="text-sm text-white/70">
            Based on transaction volume, contract interactions, and activity patterns on ${data.chainName}.
          </div>
        </div>
      `;
    }

    function renderTransactionHistory(data) {
      const history = document.getElementById('transactionHistory');
      
      if (data.transactions.length === 0) {
        history.innerHTML = '<div class="text-center text-white/60 py-8">No recent transactions found</div>';
        return;
      }

      history.innerHTML = data.transactions.map(tx => {
        const value = (parseFloat(tx.value) / Math.pow(10, 18)).toFixed(4);
        const date = new Date(parseInt(tx.timeStamp) * 1000);
        const isIncoming = tx.to.toLowerCase() === data.address.toLowerCase();
        
        return `
          <div class="bg-white/10 rounded-xl p-4 border border-white/20 hover:bg-white/15 transition-colors">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-${isIncoming ? 'green' : 'red'}-500/20 flex items-center justify-center">
                  <svg class="w-5 h-5 text-${isIncoming ? 'green' : 'red'}-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${isIncoming ? 'M7 16l-4-4m0 0l4-4m-4 4h18' : 'M17 8l4 4m0 0l-4 4m4-4H3'}"></path>
                  </svg>
                </div>
                <div>
                  <div class="text-white font-semibold">${value} ${data.chainName === 'Ethereum' ? 'ETH' : 'tokens'}</div>
                  <div class="text-sm text-white/60">${isIncoming ? 'Received' : 'Sent'}</div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-sm text-white/70">${date.toLocaleDateString()}</div>
                <div class="text-xs text-white/50">${formatAddress(tx.hash)}</div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      initializeChainSelector();
      
      const chainSelector = document.getElementById('chainSelector');
      const walletInput = document.getElementById('walletInput');
      const analyzeBtn = document.getElementById('analyzeBtn');

      chainSelector.addEventListener('change', (e) => {
        updateChainInfo(e.target.value);
      });

      walletInput.addEventListener('input', () => {
        const hasChain = chainSelector.value;
        const hasAddress = walletInput.value.trim();
        analyzeBtn.disabled = !(hasChain && hasAddress && isValidAddress(hasAddress, chainSelector.value));
      });

      analyzeBtn.addEventListener('click', async () => {
        const address = walletInput.value.trim();
        const chain = chainSelector.value;
        
        if (!address || !chain) {
          alert('Please select a blockchain and enter a wallet address');
          return;
        }
        
        await analyzeWallet(address, chain);
      });

      walletInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          analyzeBtn.click();
        }
      });
    });
  </script>
</body>
</html>

